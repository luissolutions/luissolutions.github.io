<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Question to JSON Converter</title>
    <style>
        #outputData,
        #textInput {
            width: 90%;
            height: 200px;
            margin: 10px;
        }
    </style>
</head>

<body>
    <h1>Quiz Question to JSON Converter</h1>
    <div>
        <textarea id="textInput" placeholder="Paste quiz question text here..."></textarea><br>
        <button id="paste-btn">Paste</button>
    </div>
    <input type="checkbox" id="multiQuestionCheckbox"> <label for="multiQuestionCheckbox">Multiple Questions</label><br>
    <button id="convertButton">Convert to JSON</button><br>
    <div>
        <textarea id="outputData" placeholder="Converted JSON will appear here..." readonly></textarea>
    </div>
    <button id="copy-btn">Copy</button>
    <script>
        document.getElementById('convertButton').addEventListener('click', function () {
            var textInput = document.getElementById('textInput').value;
            var isMultiQuestion = document.getElementById('multiQuestionCheckbox').checked;

            if (textInput.trim() === '') {
                alert("Please paste the quiz question text first!");
                return;
            }

            var jsonData = isMultiQuestion ? convertMultiQuestionTextToJSON(textInput) : convertTextToJSON(textInput);
            document.getElementById('outputData').value = JSON.stringify(jsonData, null, 2);
        });

        function convertTextToJSON(text) {
            var lines = text.split('\n');
            var question = lines[0].trim(); // Extract the first line as the question
            var options = lines.slice(1).map(line => line.trim()); // Extract the remaining lines as options

            // Identify correct answers and clean options
            var correctAnswers = [];
            var cleanedOptions = options.map(option => {
                if (option.includes("( Missed)")) {
                    correctAnswers.push(option.replace("( Missed)", "").trim());
                    return option.replace("( Missed)", "").trim();
                }
                return option;
            });

            var jsonObject = {
                "correctAnswer": correctAnswers,
                "description": "Question Description Here",
                "options": cleanedOptions,
                "question": question
            };

            return jsonObject;
        }

        function convertDataFormat(data) {
            var newFormat = {};

            Object.keys(data.flashcards).forEach(key => {
                var flashcard = data.flashcards[key];

                // Collect all possible answers
                var allAnswers = Object.keys(data.flashcards).map(k => data.flashcards[k].expectedAnswer);

                // Randomly pick two different answers from allAnswers
                var fillerAnswers = allAnswers.filter(answer => answer !== flashcard.expectedAnswer);
                shuffleArray(fillerAnswers);
                var selectedFillers = fillerAnswers.slice(0, 2);

                newFormat[key] = {
                    question: flashcard.example,
                    description: flashcard.description || "description here", // Default description if not provided
                    options: [flashcard.expectedAnswer, ...selectedFillers],
                    correctAnswer: flashcard.expectedAnswer
                };
            });

            return newFormat;
        }

        // Function to shuffle an array (Fisher-Yates Shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                let j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function convertMultiQuestionTextToJSON(text) {
            var allQuestions = text.split('Your answer to this question is incorrect or incomplete.').map(q => q.trim());
            var jsonOutput = {};

            allQuestions.forEach((questionBlock, index) => {
                if (questionBlock) {
                    var lines = questionBlock.split('\n');
                    var description = index === 0 ? lines[0].trim() : "Additional Question"; // For first question, use the first line as description
                    var question = index === 0 ? lines[1].trim() : lines[0].trim();
                    var options = (index === 0 ? lines.slice(2) : lines.slice(1)).map(line => line.trim());

                    // Extract correct answers
                    var correctAnswers = options.filter(option => option.includes("( Missed)")).map(option => option.replace("( Missed)", "").trim());
                    var cleanedOptions = options.map(option => option.replace("( Missed)", "").trim());

                    jsonOutput[`question${index + 1}`] = {
                        "correctAnswer": correctAnswers.length > 1 ? correctAnswers : correctAnswers[0],
                        "description": description,
                        "options": cleanedOptions,
                        "question": question
                    };
                }
            });

            return jsonOutput;
        }

        document.getElementById('paste-btn').addEventListener('click', function () {
            navigator.clipboard.readText()
                .then(text => {
                    document.getElementById('textInput').value = text;
                })
                .catch(err => {
                    console.error('Failed to read clipboard contents: ', err);
                });
        });

        document.getElementById('copy-btn').addEventListener('click', function () {
            var content = document.getElementById('outputData').value;
            navigator.clipboard.writeText(content)
                .then(() => {
                    alert('Content copied to clipboard!');
                })
                .catch(err => {
                    console.error('Failed to copy text: ', err);
                });
        });

    </script>
</body>

</html>