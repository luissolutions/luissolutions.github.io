<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combined Viewer</title>
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        th,
        td,
        tr {
            border: 1px solid black;
            text-align: left;
            width: auto;
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        @media only screen and (max-width: 500px) {
            img {
                width: 350px;
            }
        }
    </style>
</head>

<body>
    <section>
        <input type="file" id="inputFile" accept=".json,.csv" />
        <table id="output"></table>
        <button id="saveJSON">Save JSON</button>
        <button id="saveCSV">Save CSV</button>
    </section>
    <script>
        const inputFile = document.getElementById('inputFile');
        const outputTable = document.getElementById('output');
        const saveJSONButton = document.getElementById('saveJSON');
        const saveCSVButton = document.getElementById('saveCSV');

        // Function to save JSON data as a file
        function saveJSONFile(data, filename) {
            var jsonData = JSON.stringify(data, null, 2);
            var blob = new Blob([jsonData], { type: 'application/json' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Function to save CSV data as a file
        function saveCSVFile(data, filename) {
            var csvContent = 'data:text/csv;charset=utf-8,';
            data.forEach(function (row) {
                var rowData = Object.values(row).join(',');
                csvContent += rowData + '\r\n';
            });
            var encodedUri = encodeURI(csvContent);
            var link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        saveJSONButton.addEventListener('click', function () {
            var tableRows = Array.from(document.querySelectorAll('#output tr'));
            var jsonData = [];
            var headerCells = tableRows[0].querySelectorAll('th');
            var dataCells = tableRows.slice(1).map(row => row.querySelectorAll('td'));

            dataCells.forEach(function (cells) {
                var entry = {};
                cells.forEach(function (cell, index) {
                    entry[headerCells[index].textContent] = cell.textContent;
                });
                jsonData.push(entry);
            });

            var filename = 'tableData.json';
            saveJSONFile(jsonData, filename);
        });

        saveCSVButton.addEventListener('click', function () {
            var tableRows = Array.from(document.querySelectorAll('#output tr'));
            var csvData = [];
            var headerCells = tableRows[0].querySelectorAll('th');
            var dataCells = tableRows.slice(1).map(row => row.querySelectorAll('td'));

            // Prepare CSV data array
            dataCells.forEach(function (cells) {
                var rowData = [];
                cells.forEach(function (cell) {
                    rowData.push(cell.textContent);
                });
                csvData.push(rowData);
            });

            var filename = 'tableData.csv';
            saveCSVFile(csvData, filename);
        });

        inputFile.addEventListener('change', function (evt) {
            var file = evt.target.files[0];
            var reader = new FileReader();
            reader.onload = function (e) {
                var contents = e.target.result;
                var output = document.getElementById('output');
                output.innerHTML = '';

                try {
                    var data = JSON.parse(contents);
                    if (Array.isArray(data)) {
                        displayTableFromJSON(data);
                    } else if (typeof data === 'object') {
                        displayTableFromJSON([data]);
                    }
                } catch (jsonError) {
                    try {
                        var rows = contents.split('\n');
                        if (rows.length > 0) {
                            var csvData = [];
                            var headers = rows[0].split(',');
                            for (var i = 1; i < rows.length; i++) {
                                var cols = rows[i].split(',');
                                if (cols.length === headers.length) {
                                    var rowData = {};
                                    for (var j = 0; j < headers.length; j++) {
                                        rowData[headers[j]] = cols[j];
                                    }
                                    csvData.push(rowData);
                                }
                            }
                            if (csvData.length > 0) {
                                displayTableFromJSON(csvData);
                            }
                        }
                    } catch (csvError) {
                        output.textContent = "Error: Invalid file format";
                    }
                }
            };
            reader.readAsText(file);
        });

        function displayTableFromJSON(jsonData) {
            if (jsonData.length === 0) return;

            var headerRow = document.createElement('tr');
            var headers = Object.keys(jsonData[0]);
            headers.forEach(function (header) {
                var headerCell = document.createElement('th');
                headerCell.textContent = header;
                headerRow.appendChild(headerCell);
            });
            outputTable.appendChild(headerRow);

            jsonData.forEach(function (entry) {
                var row = document.createElement('tr');
                headers.forEach(function (header) {
                    var cell = document.createElement('td');
                    cell.textContent = entry[header];
                    row.appendChild(cell);
                });
                outputTable.appendChild(row);
            });
        }

    </script>
</body>