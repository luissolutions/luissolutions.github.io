<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Information Learning App</title>
  <link rel="stylesheet" href="./assets/css/app-styles.css" id="stylesheet">
  <link rel="icon" href="./assets/img/t_logo.png" sizes="32x32" type="image/png" />
  <style>
    #sidebar:not(.hidden) {
      transform: translateX(0);
    }

    #toggleSidebar {
      position: fixed;
      top: 20px;
      left: 10px;
      cursor: pointer;
    }

    #hideSidebarBtn {
      cursor: pointer;
      margin-bottom: 15px;
      transition: transform 0.3s ease;
    }
  </style>
</head>

<body>
  <header>
    <img src="./assets/img/t_logo.png" alt="Logo">

    <section class="stats">
      <div id="scoreDisplay">Learned: 0% (0 correct / 0 wrong)</div>
      <div id="timer">Time: <span id="timer-value"></span> s</div>
      <div>
        <div id="highScore">High Scores:</div>
      </div>
    </section>
    </section>
    <section style="display: none;" id="login-section">
      <form id="login-form">
        <label for="username">Email:</label>
        <input type="email" id="username" required>
        <br>
        <label for="password">Password:</label>
        <input type="password" id="password" required>
        <br>
        <button type="submit">Login</button>
      </form>
      <button id="logout" style="display: none;">Logout</button>
    </section>
  </header>

  <main>
    <section>
      <div>
        <input type="text" id="filterInput" placeholder="Filter questions">
        <button id="filterButton">Filter</button>
      </div>
      </div>
      <label>
        <input type="radio" name="questionType" value="multipleChoice" checked> Multiple Choice
      </label>
      <label>
        <input type="radio" name="questionType" value="textInput"> Text Input
      </label>
      <label>
        <input type="radio" name="questionType" value="flashcard"> Flashcard
      </label>
      <div>
        <div>
          <input type="checkbox" id="showIncorrect">
          <label for="showIncorrect">Show Incorrect Answers</label>
        </div>
        <div id="questionCounter">Questions Remaining: 0</div>
        <div>
          <input type="checkbox" id="saveQuestionCheckbox">
          <label for="saveQuestionCheckbox">Save Question</label>
          <button id="loadSavedQuestionsButton">Load Saved Questions</button>
        </div>
    </section>

    <section>
      <div id="quizSection"></div>
      <button id="submitAnswer">Submit Answer</button>
      <button id="nextQuestion">Next Question</button>
      <button id="showAnswerButton" style="display:none;">Show Answer</button>
    </section>

    <button id="addNewQuestionButton">Add New Question</button>
    <button id="editQuestionButton">Edit Current Question</button>

    <section id="addQuestion" style="display: none;">
      <h2 id="formTitle">Add Question</h2>
      <form>
        <input type="text" id="newDescription" placeholder="Enter Description" />
        <input type="text" id="newQuestion" placeholder="Enter Question" />
        <input type="text" id="options" placeholder="Enter Options" />
        <input type="text" id="correctAnswer" placeholder="Enter Answer" />
        <button id="addQuestionButton">Add Question</button>
        <button id="deleteQuestionButton">Delete Current Question</button>
        <button id="downloadData">Download Questions</button>
      </form>
    </section>
  </main>

  <button id="toggleSidebar" class="toggleSidebar">&rarr; Show Index</button>

  <aside id="sidebar" class="hidden">
    <button id="hideSidebarBtn" class="toggleSidebar">&larr; Hide Index</button>
    <div id="indexKey"></div>
    <br>
  </aside>

  <script type="module">
    import { getDatabase, database, ref, onValue, push, set, remove } from './assets/js/firebase-init.js';
    import { getCurrentUserUID } from "./assets/js/login.js";

    let currentQuestionIndex = 0;
    let correctAnswersCount = 0;
    let wrongAnswersCount = 0;
    let questions = [];
    let allQuestions = [];
    let answeredQuestions = {};
    let currentQuestionId = null;
    let currentDescription = '';
    let timerInterval;
    let timeElapsed = 0;

    function saveToFirebase(path, value) {
      const userId = getCurrentUserUID();
      if (!userId) {
        console.error("No user ID found. User may not be logged in.");
        return;
      }

      const dataRef = ref(database, `${userId}/quizData/${path}`);
      set(dataRef, value)
        .then(() => console.log("Data saved successfully"))
        .catch((error) => console.error("Error saving data:", error));
    }

    function loadFromFirebase(path, defaultValue, callback) {
      const userId = getCurrentUserUID();
      if (!userId) {
        console.error("No user ID found. User may not be logged in.");
        return;
      }

      const dataRef = ref(database, `${userId}/quizData/${path}`);
      onValue(dataRef, (snapshot) => {
        const data = snapshot.val();
        callback(data !== null ? data : defaultValue);
      });
    }

    function startTimer() {
      const currentTime = Date.now();
      saveToFirebase('startTime', currentTime);

      updateElapsedTime(currentTime);
    }

    function updateElapsedTime(startTime) {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        const currentTime = Date.now();
        timeElapsed = Math.floor((currentTime - startTime) / 1000);

        const formattedTime = formatTime(timeElapsed);
        document.getElementById('timer-value').textContent = formattedTime;
      }, 1000);
    }

    function formatTime(seconds) {
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      const remainingSeconds = seconds % 60;
      return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
    }

    function stopTimer() {
      clearInterval(timerInterval);
    }

    function updateHighScore() {
      const highScoresPath = 'highScores';
      const highScores = loadFromLocalStorage('highScores', '[]');

      const totalQuestions = correctAnswersCount + wrongAnswersCount;
      const percentage = Math.round((correctAnswersCount / totalQuestions) * 100);
      const timeTaken = formatTime(timeElapsed);

      let playerName = prompt("New high score! Enter your name:");
      if (!playerName) {
        return;
      }

      highScores.push({
        name: playerName,
        correctAnswers: correctAnswersCount,
        totalQuestions: totalQuestions,
        percentage: percentage,
        time: timeTaken
      });

      saveToFirebase(highScoresPath, highScores);
      saveToLocalStorage('highScores', highScores);

      displayHighScores(highScores);
    }

    function displayHighScores(highScores) {
      const highScoreElement = document.getElementById('highScore');
      highScoreElement.innerHTML = 'High Scores:<br>';

      highScores.forEach((scoreEntry) => {
        highScoreElement.innerHTML += `${scoreEntry.name}:  ${scoreEntry.percentage}% (${scoreEntry.correctAnswers} out of ${scoreEntry.totalQuestions}) ${scoreEntry.time}<br>`;
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      const userId = getCurrentUserUID();

      if (userId) {
        loadFromFirebase('startTime', null, (savedStartTime) => {
          if (savedStartTime) {
            updateElapsedTime(savedStartTime);
          } else {
            startTimer();
          }
        });

        loadFromFirebase('highScores', [], (highScores) => {
          displayHighScores(highScores);
        });
        loadSavedData();
        registerEventListeners();
        fetchQuestions();
      } else {
        console.error("User not authenticated. Data loading skipped.");
      }
    });

    function saveToLocalStorage(key, value) {
      localStorage.setItem(key, JSON.stringify(value));
    }

    function loadFromLocalStorage(key, defaultValue) {
      return JSON.parse(localStorage.getItem(key) || defaultValue);
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function updateScoreDisplay() {
      const totalAnswers = correctAnswersCount + wrongAnswersCount;
      const scorePercentage = totalAnswers === 0 ? 0 : Math.round((correctAnswersCount / totalAnswers) * 100);
      document.getElementById('scoreDisplay').textContent = `Learned: ${scorePercentage}% (${correctAnswersCount} correct / ${wrongAnswersCount} wrong)`;
      saveToLocalStorage('correctAnswersCount', correctAnswersCount);
      saveToLocalStorage('wrongAnswersCount', wrongAnswersCount);
    }

    function registerEventListeners() {
      document.getElementById('submitAnswer').addEventListener('click', submitAnswer);
      document.getElementById('nextQuestion').addEventListener('click', displayNextQuestion);
      document.getElementById('filterButton').addEventListener('click', filterQuestions);
      document.getElementById('showAnswerButton').addEventListener('click', showAnswer);
      document.getElementById('addNewQuestionButton').addEventListener('click', showAddQuestionForm);
      document.getElementById('editQuestionButton').addEventListener('click', editCurrentQuestion);
      document.getElementById('addQuestionButton').addEventListener('click', handleAddOrUpdateQuestion);
      document.getElementById('downloadData').addEventListener('click', downloadQuestions);
      document.getElementById('deleteQuestionButton').addEventListener('click', deleteCurrentQuestion);
      document.getElementById('saveQuestionCheckbox').addEventListener('change', () => {
        handleSaveQuestion(questions[currentQuestionIndex]);
      });
      document.getElementById('loadSavedQuestionsButton').addEventListener('click', loadSavedQuestions);
      document.getElementById('showIncorrect').addEventListener('change', toggleShowIncorrect);
      document.querySelectorAll('input[name="questionType"]').forEach(radio => {
        radio.addEventListener('change', () => {
          if (questions.length > 0) displayQuestion(questions[currentQuestionIndex]);
        });
      });
    }

    function fetchQuestions(applyFilter = false) {
      const showIncorrect = document.getElementById('showIncorrect').checked;
      const filterText = document.getElementById('filterInput').value.toLowerCase();
      const questionsRef = ref(database, 'share/questions');

      onValue(questionsRef, snapshot => {
        allQuestions = [];
        const data = snapshot.val();

        if (data) {
          for (const [description, questionsData] of Object.entries(data)) {
            for (const [key, value] of Object.entries(questionsData)) {
              allQuestions.push({ id: key, description, ...value });
            }
          }
        }

        questions = filterQuestionsList(allQuestions, showIncorrect);
        if (applyFilter) {
          questions = questions.filter(q => q.description.toLowerCase().includes(filterText));
        }

        shuffleArray(questions);
        currentQuestionIndex = 0;
        displayQuestion(questions[currentQuestionIndex]);
        updateQuestionCounter();
      });
    }

    function displayQuestion(question) {
      const quizSection = document.getElementById('quizSection');
      if (!question) {
        quizSection.innerHTML = '<p>No more questions to display.</p> <button id="resetQuiz">Reset</button>';
        document.getElementById('resetQuiz').addEventListener('click', resetQuiz);
        return;
      }

      if (currentQuestionIndex === 0) {
        updateScoreDisplay();
      }

      currentQuestionId = question.id;
      currentDescription = question.description;
      quizSection.innerHTML = `<p><strong>${question.description}:</strong><br>${question.question}</p>`;

      const questionType = document.querySelector('input[name="questionType"]:checked').value;

      if (questionType === 'textInput') {
        quizSection.innerHTML += `<input type="text" id="textInputAnswer" placeholder="Type your answer">`;
      }
      else if (questionType === 'multipleChoice' && question.options) {
        let options = shuffleArray([...question.options]);
        quizSection.innerHTML += generateOptionsHTML(options, question.correctAnswer);
      }
      else if (questionType === 'flashcard') {
        const revealButton = document.createElement('button');
        revealButton.textContent = 'Show Answer';
        revealButton.id = 'revealAnswer';
        revealButton.addEventListener('click', () => revealFlashcardAnswer(question));
        quizSection.appendChild(revealButton);
      }

      document.getElementById('saveQuestionCheckbox').checked = checkIfQuestionSaved(question.id);
    }

    function displayNextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex < questions.length) {
        displayQuestion(questions[currentQuestionIndex]);
        localStorage.setItem('currentQuestionIndex', currentQuestionIndex);
      } else {
        if (Object.keys(answeredQuestions).length === allQuestions.length) {
          document.getElementById('quizSection').innerHTML = '<p>No more questions to display.</p> <button id="resetQuiz">Reset</button>';
          document.getElementById('resetQuiz').addEventListener('click', resetQuiz);
          return;
        } else {
          currentQuestionIndex = 0;
          displayQuestion(questions[currentQuestionIndex]);
        }
      }
      updateQuestionCounter();
    }

    function showAnswer() {
      const currentQuestion = questions[currentQuestionIndex];
      const answerText = Array.isArray(currentQuestion.correctAnswer)
        ? `Correct Answers: ${currentQuestion.correctAnswer.join(', ')}`
        : `Correct Answer: ${currentQuestion.correctAnswer}`;
      alert(answerText);
    }

    function editCurrentQuestion() {
      const currentQuestion = questions[currentQuestionIndex];
      if (currentQuestion) {
        document.getElementById('newDescription').value = currentQuestion.description;
        document.getElementById('newQuestion').value = currentQuestion.question;
        document.getElementById('options').value = currentQuestion.options.join(', ');
        document.getElementById('correctAnswer').value = Array.isArray(currentQuestion.correctAnswer)
          ? currentQuestion.correctAnswer.join(', ')
          : currentQuestion.correctAnswer;

        document.getElementById('formTitle').textContent = 'Edit Question';
        document.getElementById('addQuestionButton').textContent = 'Update Question';
        document.getElementById('addQuestion').style.display = 'block';
      }
    }

    function filterQuestions() {
      const filterText = document.getElementById('filterInput').value.toLowerCase();
      questions = filterQuestionsList(allQuestions, document.getElementById('showIncorrect').checked)
        .filter(q => q.description.toLowerCase().includes(filterText));

      shuffleArray(questions);
      updateQuestionCounter();
      currentQuestionIndex = 0;
      displayQuestion(questions[currentQuestionIndex]);
    }

    function generateOptionsHTML(options, correctAnswer) {
      return options.map(option => {
        const inputType = Array.isArray(correctAnswer) ? 'checkbox' : 'radio';
        return `<label><input type="${inputType}" name="question" value="${option}">${option}</label>`;
      }).join('<br>');
    }

    function revealFlashcardAnswer(question) {
      const quizSection = document.getElementById('quizSection');
      const optionsHTML = question.options.map(option => {
        const isCorrect = Array.isArray(question.correctAnswer) ? question.correctAnswer.includes(option) : question.correctAnswer === option;
        return isCorrect ? `<strong>${option}</strong>` : option;
      }).join('<br>');

      quizSection.innerHTML += `<div>${optionsHTML}</div>`;
    }

    function filterQuestionsList(questionList, showIncorrect) {
      return questionList.filter(q => {
        if (answeredQuestions[q.id] === 'answered') return false;
        if (!showIncorrect && answeredQuestions[q.id] === 'incorrect') return false;
        return true;
      });
    }

    function submitAnswer() {
      const questionType = document.querySelector('input[name="questionType"]:checked').value;
      const currentQuestion = questions[currentQuestionIndex];

      let isCorrect = false;

      if (questionType === 'textInput') {
        const userAnswer = document.getElementById('textInputAnswer').value.trim().toLowerCase();
        isCorrect = userAnswer === currentQuestion.correctAnswer.toLowerCase();
      } else {
        isCorrect = checkAnswer(questionType, currentQuestion);
      }

      if (isCorrect) {
        answeredQuestions[currentQuestion.id] = 'answered';
        correctAnswersCount++;

        const explanationText = currentQuestion.explanation ? `\nExplanation: ${currentQuestion.explanation}` : '';
        alert(`Correct!${explanationText}`);

      } else {
        const continueToNext = confirm("Incorrect! Continue to the next question?");
        if (continueToNext) {
          answeredQuestions[currentQuestion.id] = 'incorrect';
          wrongAnswersCount++;
        } else {
          displayQuestion(currentQuestion);
          return;
        }
      }

      saveToFirebase('answeredQuestions', answeredQuestions);
      saveToFirebase('correctAnswersCount', correctAnswersCount);
      saveToFirebase('wrongAnswersCount', wrongAnswersCount);

      updateScoreDisplay();

      questions.splice(currentQuestionIndex, 1);
      updateQuestionCounter();
      displayNextQuestion();
    }

    function checkAnswer(questionType, currentQuestion) {
      if (questionType === 'multipleChoice') {
        const correctAnswer = currentQuestion.correctAnswer;

        if (Array.isArray(correctAnswer)) {
          const selectedOptions = Array.from(document.querySelectorAll('input[name="question"]:checked')).map(input => input.value);
          return checkAnswers(selectedOptions, correctAnswer);
        } else {
          const selectedOption = document.querySelector('input[name="question"]:checked');
          const userAnswer = selectedOption ? selectedOption.value : null;
          return userAnswer === correctAnswer;
        }
      } else if (questionType === 'textInput') {
        const userAnswer = document.getElementById('textInputAnswer').value.trim().toLowerCase();
        return userAnswer === currentQuestion.correctAnswer.toLowerCase();
      } else if (questionType === 'flashcard') {
        return true;
      }
      return false;
    }

    function checkAnswers(userAnswers, correctAnswers) {
      return userAnswers.length === correctAnswers.length && userAnswers.every(val => correctAnswers.includes(val));
    }

    function handleAddOrUpdateQuestion(event) {
      event.preventDefault();

      const newQuestion = document.getElementById('newQuestion').value;
      const newDescription = document.getElementById('newDescription').value;
      const options = document.getElementById('options').value.split(',').map(option => option.trim());
      const correctAnswer = document.getElementById('correctAnswer').value.includes(',')
        ? document.getElementById('correctAnswer').value.split(',').map(answer => answer.trim())
        : document.getElementById('correctAnswer').value.trim();

      if (newQuestion && newDescription && options.every(option => option) && correctAnswer) {
        if (document.getElementById('addQuestionButton').textContent === 'Update Question') {
          updateQuestionInFirebase(currentQuestionId, newQuestion, newDescription, options, correctAnswer);
        } else {
          addQuestionToFirebase(newQuestion, newDescription, options, correctAnswer);
        }
      } else {
        alert('Please fill in all fields.');
      }
    }

    function addQuestionToFirebase(question, description, options, correctAnswer) {
      const questionsRef = ref(database, `share/questions/${description}`);
      const newQuestionRef = push(questionsRef);

      set(newQuestionRef, { question, options, correctAnswer }).then(() => {
        alert('Question added to the database.');
        resetAddQuestionForm();
        fetchQuestions(true);
      });
    }

    function updateQuestionInFirebase(questionId, newQuestion, newDescription, options, correctAnswer) {
      const oldQuestionRef = ref(database, `share/questions/${currentDescription}/${questionId}`);

      remove(oldQuestionRef).then(() => {
        addQuestionToFirebase(newQuestion, newDescription, options, correctAnswer);
      });
    }

    function handleSaveQuestion(question) {
      const userId = getCurrentUserUID();
      if (!userId) {
        console.error("No user ID found. User may not be logged in.");
        return;
      }

      const isChecked = document.getElementById('saveQuestionCheckbox').checked;

      if (isChecked) {
        saveToFirebase(`savedQuestions/${question.id}`, question);
      } else {
        const questionRef = ref(database, `${userId}/quizData/savedQuestions/${question.id}`);
        remove(questionRef).then(() => {
          console.log(`Saved question: ${question.id} has been removed.`);
        }).catch((error) => {
          console.error(`Error removing question: ${error.message}`);
        });
      }
    }

    function checkIfQuestionSaved(questionId) {
      const savedQuestions = loadFromLocalStorage('savedQuestions', '[]');
      return savedQuestions.some(q => q.id === questionId);
    }

    function loadSavedQuestions() {
      loadFromFirebase('savedQuestions', [], (data) => {
        if (data && Object.keys(data).length) {
          const savedQuestions = Object.values(data);
          questions = shuffleArray(savedQuestions);
          currentQuestionIndex = 0;
          displayQuestion(questions[currentQuestionIndex]);
          updateQuestionCounter();
        } else {
          alert('No saved questions found.');
        }
      });
    }

    function showAddQuestionForm() {
      document.getElementById('addQuestion').style.display = 'block';
      resetAddQuestionForm();
    }

    function resetAddQuestionForm() {
      document.getElementById('newDescription').value = '';
      document.getElementById('newQuestion').value = '';
      document.getElementById('options').value = '';
      document.getElementById('correctAnswer').value = '';
      document.getElementById('formTitle').textContent = 'Add Question';
      document.getElementById('addQuestionButton').textContent = 'Add Question';
    }

    function updateQuestionCounter() {
      document.getElementById('questionCounter').textContent = `Questions Remaining: ${questions.length}`;
    }

    function resetQuiz() {
      stopTimer();

      const currentUserUID = localStorage.getItem("currentUserUID");

      correctAnswersCount = 0;
      wrongAnswersCount = 0;
      currentQuestionIndex = 0;
      answeredQuestions = {};
      timeElapsed = 0;

      saveToFirebase('startTime', null);

      saveToFirebase('correctAnswersCount', correctAnswersCount);
      saveToFirebase('wrongAnswersCount', wrongAnswersCount);
      saveToFirebase('answeredQuestions', answeredQuestions);

      localStorage.removeItem("correctAnswersCount");
      localStorage.removeItem("wrongAnswersCount");
      localStorage.removeItem("answeredQuestions");
      localStorage.removeItem("savedQuestions");
      localStorage.removeItem("currentQuestionIndex");

      if (currentUserUID) {
        localStorage.setItem("currentUserUID", currentUserUID);
      }

      fetchQuestions();
      updateQuestionCounter();
      updateScoreDisplay();
      startTimer();
      location.reload();
    }

    function downloadQuestions() {
      const dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(questions));
      const downloadAnchorNode = document.createElement('a');
      downloadAnchorNode.setAttribute('href', dataStr);
      downloadAnchorNode.setAttribute('download', 'questions.json');
      document.body.appendChild(downloadAnchorNode);
      downloadAnchorNode.click();
      downloadAnchorNode.remove();
    }

    function deleteCurrentQuestion() {
      if (!currentQuestionId) return;

      if (confirm("Are you sure you want to delete this question?")) {
        const questionRef = ref(database, `share/questions/${currentDescription}/${currentQuestionId}`);
        remove(questionRef).then(() => {
          alert('Question deleted successfully.');
        }).catch((error) => {
          alert('Error deleting the question: ' + error.message);
        });
      } else {
        alert('Deletion cancelled.');
      }
    }

    function toggleShowIncorrect() {
      fetchQuestions(true);
    }

    function loadSavedData() {
      loadFromFirebase('answeredQuestions', {}, (data) => {
        answeredQuestions = data;
      });

      loadFromFirebase('correctAnswersCount', 0, (data) => {
        correctAnswersCount = data;
      });

      loadFromFirebase('wrongAnswersCount', 0, (data) => {
        wrongAnswersCount = data;
      });

      loadFromFirebase('currentQuestionIndex', 0, (data) => {
        currentQuestionIndex = data;
      });

      loadFromFirebase('savedQuestions', {}, (data) => {
        if (data) {
          const savedQuestions = Object.values(data);
          saveToLocalStorage('savedQuestions', savedQuestions);
        }
      });

      updateScoreDisplay();
    }

    const sidebar = document.getElementById('sidebar');
    const toggleSidebarBtn = document.getElementById('toggleSidebar');
    const hideSidebarBtn = document.getElementById('hideSidebarBtn');

    toggleSidebarBtn.addEventListener('click', () => {
      sidebar.classList.remove('hidden');
      toggleSidebarBtn.style.display = 'none';
    });

    hideSidebarBtn.addEventListener('click', () => {
      sidebar.classList.add('hidden');
      toggleSidebarBtn.style.display = 'block';
    });

    document.addEventListener('click', (event) => {
      if (!sidebar.contains(event.target) && event.target !== toggleSidebarBtn) {
        sidebar.classList.add('hidden');
        toggleSidebarBtn.style.display = 'block';
      }
    });


    function populateIndexKey() {
      const indexKeyElement = document.getElementById('indexKey');
      indexKeyElement.innerHTML = '';

      const questionsRef = ref(database, 'share/questions');
      onValue(questionsRef, snapshot => {
        const data = snapshot.val();
        const descriptions = new Set();

        if (data) {
          for (const description in data) {
            descriptions.add(description);
          }
        }

        descriptions.forEach(description => {
          const descriptionButton = document.createElement('button');
          descriptionButton.textContent = description;
          descriptionButton.classList.add('description-btn');

          descriptionButton.addEventListener('click', () => {
            document.getElementById('filterInput').value = description;
            filterQuestions();
          });

          indexKeyElement.appendChild(descriptionButton);
        });
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      populateIndexKey();
    });

  </script>
</body>

</html>