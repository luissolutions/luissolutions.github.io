<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0,  user-scalable=no">
  <title>Information Learning App</title>
  <link rel="stylesheet" href="#" id="stylesheet">
  <link rel="icon" type="image/png" href="../assets/img/t_logo.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="../assets/img/t_logo.png" sizes="16x16" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: grey;
      color: #333;
      line-height: 1.6;
      margin: 0;
      padding: 0;
    }

    header {
      display: flex;
      justify-content: space-evenly;
      align-items: center;
      background: #333;
      color: #fff;
      padding: 1rem 0;
      text-align: center;
      box-shadow: rgba(0, 0, 0, 0.17) 0px -23px 25px 0px inset, rgba(0, 0, 0, 0.15) 0px -36px 30px 0px inset, rgba(0, 0, 0, 0.1) 0px -79px 40px 0px inset, rgba(0, 0, 0, 0.06) 0px 2px 1px, rgba(0, 0, 0, 0.09) 0px 4px 2px, rgba(0, 0, 0, 0.09) 0px 8px 4px, rgba(0, 0, 0, 0.09) 0px 16px 8px, rgba(0, 0, 0, 0.09) 0px 32px 16px;    }

    main {
      padding: 20px;
      max-width: 800px;
      margin: 20px auto;
    }

    footer {
      background: #333;
      color: #fff;
      text-align: center;
      width: 100%;
      height: 40px;
      justify-content: center;
      align-items: center;
      display: flex;
      position: fixed;
      bottom: 0;
    }

    nav {
      width: 400px;
      display: flex;
      flex-direction: column;
      overflow: auto;
    }

    a {
      color: #ddd;
    }

    ul {
      padding: 0;
    }

    iframe {
      height: 600px;
    }

    #methodExample {
      background-color: #eee;
      padding: 10px;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
    }

    input[type="text"] {
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }

    textarea {
      width: 100%;
      min-height: 130px;
      background-color: #eee;
      padding: 10px;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
      border: none;
    }

    button {
      background: #5cb85c;
      color: #fff;
      border: 0;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background: #4cae4c;
    }

    nav ul li {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }

    nav ul li button {
      margin-left: 10px;
      background-color: red;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      padding: 2px 6px;
    }

    nav ul li button:hover {
      background-color: darkred;
    }

    .collapsed {
      max-height: 29px;
      overflow: hidden;
    }

    .collapse-toggle {
      cursor: pointer;
      text-align: center;
    }

    #hint {
      color: red;
      padding: 10px;
      border: 1px solid red;
      border-radius: 5px;
      display: none;
    }

    #linksList {
      display: flex;
      flex-direction: column;
      overflow: auto;
    }

    #answerSection {
      margin-bottom: 20px;
    }

    #newDescription {
      width: 100%;
    }

    #flashcardContainer {
      background: lightgray;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    #flashcard {
      margin-bottom: 20px;
    }

    #methodDescription {
      font-size: 1.2rem;
      margin-bottom: 15px;
    }
  </style>
</head>

<body>
  <header>
    <div>
      <img src="../assets/img/t_logo.png" alt="" style="width: 190px; height: 190px;">
      <br>
      <h1>Learn what you want.</h1>
    </div>
    <nav>

      <div>
        <input type="text" placeholder="insert link" id="linkInput">
        <button id="saveLinkButton">Save</button>
      </div>
      <ul id="linksList">
        <!-- Links will be loaded here -->
      </ul>
    </nav>
  </header>

  <main id="flashcardContainer">
    <div>
      <input type="text" id="filterInput" placeholder="Filter questions">
      <button id="filterButton">Filter</button>
    </div>

    <section id="flashcard">
      <p id="methodDescription">Description of the current topic will be loaded here...</p>
      <div id="methodExample">Example or question related to the topic will be loaded here...</div>
      <br>
      <div id="answerSection">
        <input type="text" id="userAnswer" placeholder="Type your answer here">
        <button id="submitAnswer">Submit</button> <button id="showAnswer">Show Answer</button>
      </div>
    </section>

    <div id="hint">
      <p id="hintText">Hint for the answer will appear here if needed.</p>
    </div>

    <svg id="collapse-toggle" xmlns="http://www.w3.org/2000/svg" height="16" width="18"
      viewBox="0 0 576 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2023 Fonticons, Inc.-->
      <path fill="#b7bbc2"
        d="M288 80c-65.2 0-118.8 29.6-159.9 67.7C89.6 183.5 63 226 49.4 256c13.6 30 40.2 72.5 78.6 108.3C169.2 402.4 222.8 432 288 432s118.8-29.6 159.9-67.7C486.4 328.5 513 286 526.6 256c-13.6-30-40.2-72.5-78.6-108.3C406.8 109.6 353.2 80 288 80zM95.4 112.6C142.5 68.8 207.2 32 288 32s145.5 36.8 192.6 80.6c46.8 43.5 78.1 95.4 93 131.1c3.3 7.9 3.3 16.7 0 24.6c-14.9 35.7-46.2 87.7-93 131.1C433.5 443.2 368.8 480 288 480s-145.5-36.8-192.6-80.6C48.6 356 17.3 304 2.5 268.3c-3.3-7.9-3.3-16.7 0-24.6C17.3 208 48.6 156 95.4 112.6zM288 336c44.2 0 80-35.8 80-80s-35.8-80-80-80c-.7 0-1.3 0-2 0c1.3 5.1 2 10.5 2 16c0 35.3-28.7 64-64 64c-5.5 0-10.9-.7-16-2c0 .7 0 1.3 0 2c0 44.2 35.8 80 80 80zm0-208a128 128 0 1 1 0 256 128 128 0 1 1 0-256z" />
    </svg>

    <section class="collapsed">
      <section id="addFlashcard">
        <h2>Add a New Question</h2>
        <div>
          <input type="text" id="newDescription" placeholder="Question Title">
          <textarea id="newExample" placeholder="Question"></textarea>
          <input type="text" id="newExpectedAnswer" placeholder="Answer">
          <button id="addFlashcardButton">Add Flashcard</button>
          <button id="delFlashcardButton">Delete Current Flashcard</button>
        </div>
      </section>
      <br>

      <section class="other">
        <input type="text" for="loadContent" id="iframeSource" placeholder="Enter app name">
        <button id="loadContent">Load Content</button>

        <iframe id="myIframe" src="calc.html" frameBorder="0" style="width: 100%;"></iframe>

        <div class="theme-selector">
          <input type="text" id="stylesheet-input" placeholder="Enter stylesheet name">
          <button id="loadStylesheet">Load Stylesheet</button>
        </div>
      </section>
    </section>
  </main>

  <footer>
    <p>JavaScript Learning App Â© 2023</p>
  </footer>

  <script type="module">
    // Firebase App (the core Firebase SDK) import
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js';
    // Firebase Database imports
    import { getDatabase, ref, onValue, push, set, remove } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js';

    // Your web app's Firebase configuration
    const firebaseConfig = {
      databaseURL: "https://playground-e3690-default-rtdb.firebaseio.com/"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // DOM Elements
    const flashcardContainer = document.getElementById('flashcardContainer');
    const userAnswerInput = document.getElementById('userAnswer');
    const methodDescription = document.getElementById('methodDescription');
    const methodExample = document.getElementById('methodExample');
    const hintText = document.getElementById('hintText');
    const submitAnswerButton = document.getElementById('submitAnswer');
    const addFlashcardButton = document.getElementById('addFlashcardButton');

    // Flashcard Data
    let flashcards = [];
    let unansweredFlashcards = [];
    let currentFlashcardIndex = 0;
    let currentFlashcardKey = null;

    // Display Flashcard
    function displayFlashcard(flashcard) {
      currentFlashcardKey = flashcard.key; // Ensure the key is correctly set
      methodDescription.textContent = flashcard.description;
      methodExample.textContent = flashcard.example;
      hintText.style.display = 'none';
      userAnswerInput.value = '';
    }

    // Add Flashcard
    addFlashcardButton.addEventListener('click', function () {
      const newDescription = document.getElementById('newDescription').value;
      const newExample = document.getElementById('newExample').value;
      const newExpectedAnswer = document.getElementById('newExpectedAnswer').value;

      if (!newDescription || !newExample || !newExpectedAnswer) {
        alert('Please fill out all fields.');
        return;
      }

      const newFlashcard = { description: newDescription, example: newExample, expectedAnswer: newExpectedAnswer };
      const flashcardsRef = ref(database, 'flashcards');
      push(flashcardsRef, newFlashcard).then(() => {
        alert('New flashcard added!');
        clearInputFields();
        fetchFlashcardsFromFirebase();
      }).catch((error) => {
        console.error('Error adding new flashcard:', error);
      });
    });

    // Clear Input Fields
    function clearInputFields() {
      document.getElementById('newDescription').value = '';
      document.getElementById('newExample').value = '';
      document.getElementById('newExpectedAnswer').value = '';
      userAnswerInput.value = '';
    }

    // Submit Answer
    submitAnswerButton.addEventListener('click', () => {
      const userAnswer = userAnswerInput.value.toLowerCase();
      const currentFlashcard = unansweredFlashcards[currentFlashcardIndex];

      if (userAnswer.trim() === currentFlashcard.expectedAnswer.toLowerCase()) {
        alert('Correct answer!');
        // Remove correctly answered flashcard from the unansweredFlashcards array
        unansweredFlashcards.splice(currentFlashcardIndex, 1);
        if (unansweredFlashcards.length === 0) {
          alert("Congratulations! You've answered all questions correctly.");
          resetGame();
        } else {
          moveToNextFlashcard();
        }
      } else {
        alert("Incorrect");
        moveToNextFlashcard(); // Move to next flashcard even if the answer is incorrect
      }
    });

    function moveToNextFlashcard() {
      // Increment index and loop back if it exceeds the array length
      currentFlashcardIndex = (currentFlashcardIndex + 1) % unansweredFlashcards.length;
      displayFlashcard(unansweredFlashcards[currentFlashcardIndex]);
    }

    // Reset Game
    function resetGame() {
      currentFlashcardIndex = 0;
      unansweredFlashcards = [...flashcards]; // Reset to the full list of flashcards
      displayFlashcard(flashcards[currentFlashcardIndex]);
    }

    // Fetch Flashcards from Firebase with filter and shuffle
    function fetchFlashcardsFromFirebase(filterText = '') {
      const flashcardsRef = ref(database, 'flashcards');
      onValue(flashcardsRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
          flashcards = [];
          Object.keys(data).forEach((key) => {
            const flashcard = { ...data[key], key };
            if (flashcard.description.toLowerCase().includes(filterText.toLowerCase())) {
              flashcards.push(flashcard);
            }
          });
          shuffleArray(flashcards);
          unansweredFlashcards = [...flashcards]; // Copy shuffled flashcards to unansweredFlashcards

          if (flashcards.length > 0) {
            currentFlashcardIndex = 0;
            displayFlashcard(unansweredFlashcards[currentFlashcardIndex]);
          } else {
            flashcardContainer.textContent = 'No matching flashcards found.';
          }
        } else {
          flashcardContainer.textContent = 'No flashcards available.';
        }
      }, (error) => {
        console.error('Error fetching flashcards:', error);
      });
    }

    // Event listener for the filter button
    document.getElementById('filterButton').addEventListener('click', function () {
      const filterText = document.getElementById('filterInput').value;
      fetchFlashcardsFromFirebase(filterText);
    });

    // Fetch Links from Firebase
    function fetchLinksFromFirebase() {
      const linksRef = ref(database, 'links');
      onValue(linksRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
          displayLinks(data);
        }
      }, (error) => {
        console.error('Error fetching links:', error);
      });
    }

    const saveLinkButton = document.getElementById('saveLinkButton');
    const linkInput = document.getElementById('linkInput');

    saveLinkButton.addEventListener('click', () => {
      const linkUrl = linkInput.value;
      if (!linkUrl) {
        alert('Please enter a link.');
        return;
      }

      const newLinkRef = push(ref(database, 'links'));
      set(newLinkRef, { url: linkUrl })
        .then(() => {
          console.log('Link saved successfully!');
          linkInput.value = '';
          fetchLinksFromFirebase();
        })
        .catch((error) => {
          console.error('Error saving link:', error);
        });
    });

    // Display Links
    function displayLinks(links) {
      const linksList = document.getElementById('linksList');
      linksList.innerHTML = ''; // Clear existing links

      Object.keys(links).forEach(key => {
        const link = links[key];
        const listItem = document.createElement('li');
        const aTag = document.createElement('a');
        aTag.href = link.url;
        aTag.target = "_blank";
        aTag.rel = "noopener noreferrer";
        aTag.textContent = link.url;

        // Create delete button
        const deleteButton = document.createElement('button');
        deleteButton.textContent = 'X';
        deleteButton.onclick = () => deleteLink(key); // Attach event listener

        listItem.appendChild(aTag);
        listItem.appendChild(deleteButton);
        linksList.appendChild(listItem);
      });
    }

    // Delete Link
    function deleteLink(key) {
      const linkRef = ref(database, 'links/' + key);
      remove(linkRef).then(() => {
        console.log('Link removed successfully');
        fetchLinksFromFirebase(); // Refresh links display
      }).catch(error => {
        console.error('Error removing link:', error);
      });
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]]; // Swap elements
      }
    }

    document.getElementById('delFlashcardButton').addEventListener('click', function () {
      if (currentFlashcardKey) {
        const flashcardRef = ref(database, 'flashcards/' + currentFlashcardKey);
        remove(flashcardRef).then(() => {
          console.log('Flashcard removed successfully');
          fetchFlashcardsFromFirebase(); // Refresh the flashcards
        }).catch(error => {
          console.error('Error removing flashcard:', error);
        });
      } else {
        alert("No flashcard selected for deletion.");
      }
    });

    // Add this inside your script tag where other event listeners are defined
    document.getElementById('showAnswer').addEventListener('click', function () {
      // Check if there is a current flashcard
      if (unansweredFlashcards[currentFlashcardIndex]) {
        const expectedAnswer = unansweredFlashcards[currentFlashcardIndex].expectedAnswer;
        alert('Expected Answer: ' + expectedAnswer);
      } else {
        alert('No current flashcard to show answer for.');
      }
    });

    window.addEventListener('load', () => {
      fetchFlashcardsFromFirebase();
      fetchLinksFromFirebase();
    });

    document.getElementById('userAnswer').addEventListener('keyup', function (event) {
  if (event.key === 'Enter') {
    submitAnswer();
  }
});
  </script>
  <script>

    function generateButtons() {
      var buttonsHTML = '';
      appNames.forEach((name, index) => {
        buttonsHTML += `<a onclick="setIframeSrc(${index})">${name.toUpperCase()}</a>`;
      });
      dropdownContent.innerHTML = buttonsHTML;
    }

    document.getElementById('loadContent').addEventListener('click', loadIframeContent);

    document.getElementById('iframeSource').addEventListener('keyup', function (event) {
      if (event.key === "Enter") {
        loadIframeContent();
      }
    });

    function loadIframeContent() {
      var sourceName = document.getElementById('iframeSource').value;
      var fullPath = "../apps/" + sourceName + ".html";
      document.getElementById('myIframe').src = fullPath;
    }

    document.getElementById('loadStylesheet').addEventListener('click', function () {
      var stylesheetName = document.getElementById('stylesheet-input').value;
      if (stylesheetName) {
        var fullPath = "../assets/css/" + stylesheetName + ".css";
        document.getElementById('stylesheet').href = fullPath;
      } else {
        alert("Please enter a stylesheet name.");
      }
    });

    document.getElementById('collapse-toggle').addEventListener('click', function () {
      toggleSection();
    });

    function toggleSection() {
      const sections = document.querySelectorAll('.collapsed');
      sections.forEach(section => {
        section.classList.toggle('collapsed');
      });
    }

  </script>
</body>

</html>