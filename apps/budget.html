<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Tracker</title>
    <style>
        body,
        table {
            text-align: center;
            margin: 0 auto;
            max-width: 800px;
            background: whitesmoke;
        }

        th,
        td {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 8px;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>
</head>

<body>
    <header>
        <h1>Financial Tracker</h1>
    </header>

    <main>
        <section>
            <h3>Upload CSV File</h3>
            <input type="file" id="csv-file" accept=".csv">
            <button onclick="loadCSV()">Load Data</button>
        </section>

        <section>
            <h2>Add New Entry</h2>
            <form id="entry-form">
                <input type="date" id="entry-date" required>
                <select id="entry-type">
                    <option value="income">Income</option>
                    <option value="expense">Expense</option>
                </select>
                <input type="text" id="entry-description" placeholder="Description" required>
                <input type="number" id="entry-amount" placeholder="Amount" required>
                <button type="submit">Add Entry</button>
            </form>
            <button id="clear-all-data">Clear All Data</button>
        </section>

        <section>
            <h2>Entries by Year</h2>
            <input type="number" id="selected-year" value="2024" min="2000" max="2100">
            <button id="filter-year">Show Entries</button>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Description</th>
                        <th>Amount</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="yearly-entries-container"></tbody>
            </table>
            <h2>Year Totals</h2>
            <div>
                <p>Total Income: <span id="year-total-income">0</span></p>
                <p>Total Expenses: <span id="year-total-expenses">0</span></p>
                <p>Balance: <span id="year-balance">0</span></p>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('entry-form').addEventListener('submit', handleFormSubmit);
            document.getElementById('clear-all-data').addEventListener('click', clearAllData);
            document.getElementById('filter-year').addEventListener('click', filterEntriesByYear);
        });

        function handleFormSubmit(event) {
            event.preventDefault();
            const inputDate = document.getElementById('entry-date').value;
            const date = new Date(inputDate + 'T00:00');
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const type = document.getElementById('entry-type').value;
            const description = document.getElementById('entry-description').value;
            const amount = parseFloat(document.getElementById('entry-amount').value);

            addEntry(year, month, day, type, description, amount);
            filterEntriesByYear();
        }

        function addEntry(year, month, day, type, description, amount) {
            const data = JSON.parse(localStorage.getItem('financialData')) || {};
            if (!data[year]) data[year] = {};
            if (!data[year][month]) data[year][month] = {};
            if (!data[year][month][day]) data[year][month][day] = [];

            data[year][month][day].push({ type, description, amount });
            localStorage.setItem('financialData', JSON.stringify(data));
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete all financial data? This action cannot be undone.')) {
                localStorage.clear();
                document.getElementById('yearly-entries-container').innerHTML = '';
                document.getElementById('year-total-income').textContent = '0';
                document.getElementById('year-total-expenses').textContent = '0';
                document.getElementById('year-balance').textContent = '0';
                alert('All data has been cleared.');
            }
        }

        function filterEntriesByYear() {
            const selectedYear = document.getElementById('selected-year').value;
            const data = JSON.parse(localStorage.getItem('financialData')) || {};
            const entriesContainer = document.getElementById('yearly-entries-container');
            entriesContainer.innerHTML = '';

            let totalIncome = 0;
            let totalExpenses = 0;

            if (data[selectedYear]) {
                Object.keys(data[selectedYear]).forEach(month => {
                    Object.keys(data[selectedYear][month]).forEach(day => {
                        data[selectedYear][month][day].forEach((entry, index) => {
                            const fullDate = `${selectedYear}-${month}-${day}`;
                            const row = document.createElement('tr');
                            row.innerHTML = `
                        <td>${fullDate}</td>
                        <td>${entry.type}</td>
                        <td>${entry.description}</td>
                        <td>${entry.amount.toFixed(2)}</td>
                        <td><button onclick="deleteEntry('${selectedYear}', '${month}', '${day}', ${index})">Delete</button></td>
                    `;
                            entriesContainer.appendChild(row);

                            if (entry.type === 'income') {
                                totalIncome += entry.amount;
                            } else if (entry.type === 'expense') {
                                totalExpenses += entry.amount;
                            }
                        });
                    });
                });
            }

            document.getElementById('year-total-income').textContent = totalIncome.toFixed(2);
            document.getElementById('year-total-expenses').textContent = totalExpenses.toFixed(2);
            document.getElementById('year-balance').textContent = (totalIncome - totalExpenses).toFixed(2);
        }

        function deleteEntry(year, month, day, index) {
            const data = JSON.parse(localStorage.getItem('financialData'));
            if (data && data[year] && data[year][month] && data[year][month][day]) {
                data[year][month][day].splice(index, 1);
                if (data[year][month][day].length === 0) {
                    delete data[year][month][day];
                    if (Object.keys(data[year][month]).length === 0) {
                        delete data[year][month];
                        if (Object.keys(data[year]).length === 0) {
                            delete data[year];
                        }
                    }
                }
                localStorage.setItem('financialData', JSON.stringify(data));
                filterEntriesByYear(); // refresh entries display
            }
        }

        function loadCSV() {
            const fileInput = document.getElementById('csv-file');
            if (fileInput.files.length > 0) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const text = e.target.result;
                    const data = parseCSV(text);
                    data.forEach(entry => {
                        const [date, description, , amount, type] = entry;
                        const parsedDate = new Date(date);
                        const year = parsedDate.getFullYear().toString();
                        const month = (parsedDate.getMonth() + 1).toString().padStart(2, '0');
                        const day = parsedDate.getDate().toString().padStart(2, '0');
                        const transactionType = type === "credit" ? "income" : "expense";
                        addEntry(year, month, day, transactionType, description, parseFloat(amount));
                    });
                    filterEntriesByYear();
                };
                reader.readAsText(fileInput.files[0]);
            } else {
                alert("Please select a file.");
            }
        }

        function parseCSV(text) {
            const lines = text.split('\n');
            return lines.map(line => line.split(',').map(cell => cell.replace(/\"/g, '').trim()));
        }
    </script>
</body>

</html>