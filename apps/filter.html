<!DOCTYPE html>
<html>

<head>
    <title>Client Vehicle Information</title>
</head>

<body>
    <h1>Client Vehicle Information</h1>
    <input type="file" id="fileInput" accept=".csv" />
    <button onclick="handleFile()">Upload CSV</button>
    <table id="dataTable">
        <tr>
            <th>Client</th>
            <th>Start Date</th>
            <th>Start Time</th>
            <th>Start Odometer Reading</th>
            <th>Start Location</th>
            <th>End Date</th>
            <th>End Time</th>
            <th>End Odometer Reading</th>
            <th>End Location</th>
            <!-- Add more columns as needed -->
        </tr>
    </table>
    <button onclick="exportData()">Export Filtered Data</button>
    <script>
        let data = []; // Global variable to store the loaded data

        function handleFile() {
            const fileInput = document.getElementById("fileInput");
            const file = fileInput.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    const csvData = event.target.result;
                    data = parseCSV(csvData);
                    const clientNameToFilter = "John Doe"; // Change this to the desired client name
                    const filteredData = filterDataByClient(clientNameToFilter);
                    populateTable(filteredData);
                };
                reader.readAsText(file);
            }
        }

        function parseCSV(csvData) {
            const lines = csvData.split(/\r?\n/);
            const headers = lines[0].split(",");
            const rows = [];
            for (let i = 1; i < lines.length; i++) {
                const data = lines[i].split(",");
                if (data.length === headers.length) {
                    const row = {};
                    for (let j = 0; j < headers.length; j++) {
                        row[headers[j]] = data[j];
                    }
                    rows.push(row);
                }
            }
            return rows;
        }

        function filterDataByClient(clientName) {
            const filteredData = data.filter(entry => entry.Client === clientName);
            return filteredData;
        }

        function populateTable(filteredData) {
            const table = document.getElementById("dataTable");
            table.innerHTML = ""; // Clear the table

            const headerRow = table.insertRow();
            for (const key in filteredData[0]) {
                const th = document.createElement("th");
                th.textContent = key;
                headerRow.appendChild(th);
            }

            filteredData.forEach(entry => {
                const row = table.insertRow();
                for (const key in entry) {
                    const cell = row.insertCell();
                    cell.textContent = entry[key];
                }
            });
        }

        function exportData() {
            const filteredData = filterDataByClient("John Doe"); // Change this to the desired client name
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += Object.keys(filteredData[0]).join(",") + "\r\n";
            filteredData.forEach(entry => {
                const values = Object.values(entry).map(value => `"${value}"`);
                csvContent += values.join(",") + "\r\n";
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "filtered_data.csv");
            document.body.appendChild(link);
            link.click();
        }
    </script>
</body>

</html>