<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Emporium Seeder</title>
</head>

<body>
  <h1>Seeding Inventory…</h1>
  <pre id="log"></pre>

  <script type="module">
    // Use your existing Firebase no-auth init
    import { ref, set, database } from '../../assets/js/firebase-init-noauth.js';

    // TODO: set your Amazon Associates tag ONCE here to keep things consistent on future use
    const AFFILIATE_TAG = 'YOURTAG-20';

    // Paste your links here:
    const LINKS = [
      "https://a.co/d/013v0U4",
      "https://a.co/d/gqlAz5N"
    ];

    // Default bucket; you can move/rename from your admin UI later
    const DEFAULT_CATEGORY = 'Starter Picks';
    const DEFAULT_COMPONENT = 'Unsorted';

    // Minimal template for each product. You can edit in your admin UI later.
    function makeEntry(url, idx) {
      const name = `Item_${String(idx + 1).padStart(2, '0')}`;
      return {
        brand: '',
        price: '',          // optional: add your own listed price (not Amazon's live price)
        actualPrice: '',
        quantity: 0,
        description: '',
        affiliateUrl: url,  // stored raw; tag is added when rendering links
        asin: '',           // unknown from a.co short link; can fill in later
        imageUrl: `../../assets/img/database/${name}.png`,
        tags: []
      };
    }

    function sanitize(s) { return String(s || '').replace(/\//g, '_'); }

    // Helper: build a safe key from name
    function keyFromName(name) {
      return sanitize(name).replace(/\s+/g, '_').replace(/[^A-Za-z0-9_\-]/g, '');
    }

    async function seed() {
      const log = document.getElementById('log');
      let ok = 0, fail = 0;

      for (let i = 0; i < LINKS.length; i++) {
        const url = LINKS[i];
        const entry = makeEntry(url, i);

        const nameKey = keyFromName(`Item_${String(i + 1).padStart(2, '0')}`);
        const path = `inventory/${sanitize(DEFAULT_CATEGORY)}/${sanitize(DEFAULT_COMPONENT)}/${nameKey}`;
        try {
          await set(ref(database, path), entry);
          ok++;
          log.textContent += `✓ Saved ${path}\n`;
        } catch (e) {
          fail++;
          log.textContent += `✗ Failed ${path} :: ${e?.message || e}\n`;
        }
      }

      log.textContent += `\nDone. Success: ${ok}  Failed: ${fail}\n`;
      log.textContent += `Now visit index.html or catalog.html — items with affiliateUrl will render.\n`;
      log.textContent += `Tip: edit names, categories, and add images via your admin UI.\n`;
    }

    seed();
  </script>
</body>

</html>