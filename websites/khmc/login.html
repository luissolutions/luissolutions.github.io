<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" href="assets/img/mlogo.png">
    <title>Minecraft Hub</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <script src="assets/js/loader.js" defer></script>
    <script src="assets/js/index.js" defer></script>
    <script src="assets/js/sidebar.js" defer></script>
</head>

<body class="site-container">
    <header>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="#" data-path="pages/info.html"
                        onclick="loadContent(event, this.getAttribute('data-path'))">More Info</a></li>
                <li><a href="login.html">Login / Signup</a></li>
            </ul>
        </nav>
        <button id="toggleSidebar">Open Sidebar</button>
    </header>

    <main>
        <section id="home">
            <img id="logo" src="assets/img/mlogo.png" alt="Logo">
            <h1>Welcome to the Minecraft Hub</h1>
            <p>Discover and chat about your favorite Minecraft servers</p>
        </section>

        <section id="bodyContainer">
            <section id="contact-form" class="background">
                <div class="login-container form-container">
                    <h1>Login</h1>
                    <br>
                    <form id="login-form">
                        <label for="username">Username:</label>
                        <input type="text" id="login-username" name="username" required>
                        <label for="password">Password:</label>
                        <input type="password" id="login-password" name="password" required>
                        <button id="login-button" type="submit">Login</button>
                    </form>
                    <p>Don't have an account? <a href="#" id="toggle-register">Register here</a></p>
                </div>

                <div class="register-container form-container" style="display: none;">
                    <h1>Register</h1>
                    <br>
                    <form id="register-form">
                        <label for="reg-username">Username:</label>
                        <input type="text" id="reg-username" name="username" required>
                        <label for="reg-email">Email:</label>
                        <input type="email" id="reg-email" name="email" required>
                        <label for="reg-password">Password:</label>
                        <input type="password" id="reg-password" name="password" required>
                        <label for="reg-confirm-password">Confirm Password:</label>
                        <input type="password" id="reg-confirm-password" name="confirm-password" required>
                        <br>
                        <label for="agree-terms">
                            <input type="checkbox" id="agree-terms" class="agree-terms" name="agree-terms" required>
                            Agree to <a href="#" data-path="pages/terms.html"
                            onclick="loadContent(event, this.getAttribute('data-path'))">Terms &amp; Conditions</a>
                        </label>
                        <br>
                        <button id="register-button" type="submit">Register</button>
                    </form>
                    <p>Already have an account? <a href="#" id="toggle-login">Login here</a></p>
                </div>
            </section>
        </section>
    </main>

    <div id="sidebar" class="hidden">
        <div class="sidebar-content">
            <h2>Links:</h2>
            <br>
            <ul>
                <li><a href="http://oddohome.asuscomm.com:12930/web/index.html" target="_blank">Plex</a></li>
                <li><a href="https://minecraft.fandom.com/wiki/Minecraft_Wiki" target="_blank">Wiki</a></li>
                <li><a href="http://twitch.tv/minecraft" target="_blank">Twitch</a></li>
                <li><a href="https://minecraft-server-list.com/server/502719/?fbclid=IwAR0Keyj393G0OgXomKf6mOKk496lwDm-Gm7kB0C4BXHjIUuo9kgXd00D5lM#"
                        target="_blank">Server</a></li>
                <li><a href="https://www.mediafire.com/file/w4sf38k9tlm4bq0/mods.rar/file?fbclid=IwAR2lhaa8uWaKUFacjDicB6mBsr8kZL4qmOtM1h65ydHD3UfGM2p6kXHS2A0"
                        target="_blank">Modpack</a></li>
                <li><a href="https://minecraft.com/" target="_blank">Minecraft</a></li>
                <li><a href="#" data-path="pages/hangman.html"
                        onclick="loadContent(event, this.getAttribute('data-path'))">Hangman</a></li>
                <li><a href="https://geysermc.org/">GeyserMC</a></li>
                <li><a href="https://mohistmc.com/">MohistMC</a></li>
                <li><a href="https://www.curseforge.com/" target="_blank">Curse Forge</a></li>
                <li><a href="https://www.xbox.com/en-us/games/store/minecraft-java-bedrock-edition-for-pc/9nxp44l49shj"
                        target="_blank">Buy Minecraft</a></li>
                <li><a href="oddohome.asuscomm.com:25566" target="_blank">Server Address</a></li>
                <li><a href="https://www.feed-the-beast.com/" target="_blank">Feed The Beast</a></li>
                <li><a href="#" data-path="pages/iframe.html"
                        onclick="loadContent(event, this.getAttribute('data-path'))">Command Blocks</a></li>
                <li><a href="https://gamesdonequick.com/" target="_blank">Games Done Quick</a></li>
                <li><a href="other.html">Pok√©mon Trading Hub</a></li>
            </ul>
            <br>
            <iframe id="chatAppIframe" src="pages/chat.html"></iframe>

        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                <a href="https://luissolutions.github.io/websites/game/index.html"><img src="assets/img/mariohead.png"
                        alt="Logo"></a>
            </div>
            <div class="footer-links">
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="#" data-path="pages/contact.html"
                            onclick="loadContent(event, this.getAttribute('data-path'))">Contact</a></li>
                    <li><a href="#" data-path="pages/videos.html"
                            onclick="loadContent(event, this.getAttribute('data-path'))">Videos</a></li>
                </ul>
            </div>
            <div class="footer-social">
                <ul>
                    <li><a href="https://facebook.com" target="_blank"><img src="../../assets/img/white-facebook.png"
                                alt="Facebook"></a></li>
                    <li><a href="https://twitter.com" target="_blank"><img src="../../assets/img/white-twitter.png"
                                alt="Twitter"></a>
                    </li>
                    <li><a href="https://minecraft-server-list.com/server/502719/?fbclid=IwAR0Keyj393G0OgXomKf6mOKk496lwDm-Gm7kB0C4BXHjIUuo9kgXd00D5lM"
                            target="_blank"><img src="../../assets/img/white-instagram.png" alt="Minecraft"></a></li>
                    <li><a href="http://youtube.com/louman61/" target="_blank"><img
                                src="../../assets/img/white-youtube.png" alt="Youtube"></a></li>
                </ul>
            </div>
        </div>
        <div class="footer-text">
            &copy; 2024 Luis Apps. All rights reserved.
        </div>
    </footer>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, off } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

        const firebaseConfig = {
            databaseURL: "https://playground-e3690-default-rtdb.firebaseio.com/"
        };
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        async function registerUser(username, email, password) {
            const ipAddress = await getIP();
            const newUserRef = push(ref(database, 'users'));
            await set(newUserRef, { username, email, password, ipAddress });
            return newUserRef.key;
        }

        function handleRegisterFormSubmission(event) {
            event.preventDefault();

            const username = document.getElementById("reg-username").value;
            const email = document.getElementById("reg-email").value;
            const password = document.getElementById("reg-password").value;
            const confirmPassword = document.getElementById("reg-confirm-password").value;

            if (password !== confirmPassword) {
                alert("Passwords do not match. Please try again.");
                return;
            }

            registerUser(username, email, password)
                .then(() => {
                    alert("Registration successful!");
                    document.getElementById("register-form").reset();
                    window.location.href = 'login.html';
                })
                .catch(error => {
                    alert("Failed to register user. Error: " + error.message);
                });
        }

        async function loginUser(username, password) {
            return new Promise((resolve, reject) => {
                const usersRef = ref(database, "users");
                onValue(usersRef, snapshot => {
                    const users = snapshot.val();
                    const matchingUser = Object.values(users || {}).find(user =>
                        user.username === username && user.password === password
                    );

                    if (matchingUser) {
                        resolve(matchingUser);
                    } else {
                        reject(new Error("Invalid username or password."));
                    }

                    off(usersRef);
                }, {
                    onError: reject
                });
            });
        }

        function handleLoginFormSubmission(event) {
            event.preventDefault();
            const username = document.getElementById("login-username").value;
            const password = document.getElementById("login-password").value;

            loginUser(username, password).then(() => {
                const sToken = "7777777";
                localStorage.setItem("sToken", sToken);
                alert("Login Successful.");
                // For example: window.location.href = 'home.html';
            }).catch(error => {
                alert("Invalid username or password. Please try again.");
            });
        }

        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById('register-form').addEventListener('submit', handleRegisterFormSubmission);
            document.getElementById('login-form').addEventListener('submit', handleLoginFormSubmission);
        });

        function getIP() {
            return fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => data.ip);
        }
    </script>
    <script>
        function toggleForms() {
            document.addEventListener('click', function (event) {
                if (event.target.matches('#toggle-register')) {
                    event.preventDefault();
                    document.querySelector('.login-container').style.display = 'none';
                    document.querySelector('.register-container').style.display = 'block';
                } else if (event.target.matches('#toggle-login')) {
                    event.preventDefault();
                    document.querySelector('.register-container').style.display = 'none';
                    document.querySelector('.login-container').style.display = 'block';
                }
            });
        }

        toggleForms();
    </script>

</body>

</html>