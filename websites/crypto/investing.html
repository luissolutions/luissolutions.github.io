<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Investment Strategies & Retirement Planning — Expanded</title>
    <link rel="stylesheet" href="assets/css/styles.css" />
    <script src="assets/js/html.js" defer></script>
    <script src="assets/js/sidebar.js" defer></script>
    <script type="module" src="assets/js/auth-handling.js" defer></script>
    <!-- Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
    <style>
        .tooltip {
            position: relative;
            cursor: help;
            border-bottom: 1px dashed currentColor;
            outline-offset: 2px
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primaryColor);
            color: var(--textColor);
            padding: .4em .6em;
            border-radius: 4px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity .2s;
            z-index: 100;
            box-shadow: rgba(0, 0, 0, .15) 0 6px 16px
        }

        .tooltip:hover::after,
        .tooltip:focus-visible::after {
            opacity: 1
        }

        .visually-hidden {
            position: absolute !important;
            height: 1px;
            width: 1px;
            overflow: hidden;
            clip: rect(1px, 1px, 1px, 1px);
            white-space: nowrap
        }

        /* Lightweight layout helpers (not in your global CSS) */
        .grid {
            display: grid;
            gap: 16px
        }

        .grid.two {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr))
        }

        .grid.three {
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr))
        }

        .card {
            background: var(--textColor);
            color: var(--primaryColor);
            border-radius: 8px;
            padding: 16px;
            box-shadow: rgba(0, 0, 0, .06) 0 4px 16px, rgba(0, 0, 0, .04) 0 0 0 1px
        }

        /* Calculators */
        .calc-form {
            background: var(--formBackground);
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 12px;
            max-width: 520px;
            margin: 1rem auto;
            overflow: hidden;
        }

        .calc-form label {
            display: block;
            margin: .5rem 0 .25rem;
            font-weight: 700;
            color: var(--primaryColor)
        }

        .calc-form input,
        .calc-form select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            background: var(--entryBackground);
            color: var(--primaryColor);
            box-sizing: border-box
        }

        .calc-form .inline {
            display: flex;
            gap: 12px;
            flex-wrap: wrap
        }

        .calc-form .inline>div {
            flex: 1 1 160px
        }

        .calc-form .flex {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: .25rem 0
        }

        .calc-form .btn-row {
            display: flex;
            gap: 8px;
            margin-top: .6rem;
            flex-wrap: wrap
        }

        .calc-form button {
            background: var(--secondaryColor);
            color: var(--textColor);
            border: none;
            border-radius: 6px;
            padding: 10px 14px;
            cursor: pointer
        }

        .calc-form button:hover {
            background: #d25400
        }

        .calc-result {
            text-align: center;
            margin-top: .75rem;
            font-weight: 700;
            background: var(--entryBackground);
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #ccc
        }

        .calc-result[aria-live] {
            min-height: 3.25rem
        }

        #houseChart {
            max-width: 100%;
            height: auto
        }
        nav ul {
            padding: 0;
        }
    </style>
</head>

<body>
    <header></header>
    <nav></nav>
    <div class="header" style="text-align: center;">
        <h1>Investment Strategies & Retirement Planning</h1>
    </div>

    <nav>
        <ul
            style="list-style:none;display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:0;">
            <li><a href="#quick-start">Quick Start</a></li>
            <li><a href="#retirement-strategies">Retirement & Investment</a></li>
            <li><a href="#fund-types">Index Funds vs ETFs</a></li>
            <li><a href="#accounts">Account Types & Taxes</a></li>
            <li><a href="#short-term-cash">Short‑Term Cash/Yield</a></li>
            <li><a href="#investment-charts">Charts</a></li>
            <li><a href="#calculators">Calculators</a></li>
            <li><a href="#faq">FAQ</a></li>
            <li><a href="#definitions">Definitions</a></li>
        </ul>
    </nav>

    <main>
        <!-- QUICK START -->
        <section id="quick-start" class="card">
            <h2>Quick Start: Near‑Term Savings vs Long‑Term Investing</h2>
            <div class="grid two">
                <div>
                    <h3>Near‑Term Savings (12–24 months)</h3>
                    <ul>
                        <li>Keep it <strong>safe & liquid</strong>: HYSAs, no‑penalty CDs, short‑term Treasuries or
                            ultra‑short Treasury ETFs.</li>
                        <li>Goal: <strong>preserve principal</strong>, accept modest yield.</li>
                        <li class="muted">Examples: moving fund, car purchase, small business startup, down payment.
                        </li>
                    </ul>
                </div>
                <div>
                    <h3>Long‑Term Investing (5+ years)</h3>
                    <ul>
                        <li>Broad, low‑cost <strong>index ETFs</strong> (Total US / Total Int’l / Bonds) or target‑date
                            funds.</li>
                        <li>Automate contributions in tax‑advantaged accounts when eligible (Roth/Traditional IRA,
                            401(k)).</li>
                        <li>Rebalance occasionally; focus on <em>total return</em> and time in the market.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- RETIREMENT & INVESTMENT STRATEGIES -->
        <section id="retirement-strategies">
            <h2>Retirement and Investment Strategies</h2>
<br>
            <article class="card">
                <h3>Dividend‑Oriented Portfolios (as an example)</h3>
                <p>A diversified, dividend‑tilted portfolio can generate income, but yields vary and higher yield often
                    means higher risk. Many investors prioritize <em>total return</em> (dividends + price growth) with
                    broad index ETFs and let income be a by‑product.</p>
                <ul>
                    <li class="muted">Illustrations: 3–4% yield on $100k ≈ $3–4k/yr; $500k ≈ $15–20k/yr; $1M ≈
                        $30–40k/yr (before taxes). Not guarantees.</li>
                    <li>Use reinvestment for growth, or route distributions to cash if you need ongoing income.</li>
                </ul>
            </article>

            <article class="card">
                <h3>Real Estate Strategy (Owner‑Occupant & Beyond)</h3>
                <ul>
                    <li><strong>House‑hack a duplex:</strong> live in one unit, rent the other. Consider vacancy (5–8%),
                        maintenance/CapEx (5–10%), management (8–10% if not self‑managing), taxes & insurance.</li>
                    <li><strong>Leverage carefully:</strong> debt magnifies outcomes. Keep a repair reserve and
                        stress‑test rents down 10% and rates up 1%.</li>
                </ul>
            </article>

            <article class="card">
                <h3>Roth IRA Strategy</h3>
                <ul>
                    <li>Contributions are after‑tax; qualified withdrawals are tax‑free.</li>
                    <li>Dividends/reinvestments inside the Roth do <em>not</em> count toward the annual contribution
                        limit.</li>
                    <li>Use broad index ETFs and automate contributions when you can.</li>
                </ul>
            </article>
        </section>

        <!-- INDEX FUNDS VS ETFs -->
        <section id="fund-types">
            <h2>Index Funds vs ETFs (What’s the Difference?)</h2>
            <div class="grid two">
                <div class="card">
                    <h3>Index Funds (Mutual Funds)</h3>
                    <ul>
                        <li>Track an index; priced once daily at NAV.</li>
                        <li>Great for auto‑investing; sometimes investment minimums.</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>ETFs (Exchange‑Traded Funds)</h3>
                    <ul>
                        <li>Often track the same indexes; trade all day like a stock.</li>
                        <li>Usually superb tax efficiency and low cost.</li>
                    </ul>
                </div>
            </div>
            <p class="muted">Both can be passive and diversified. On platforms like M1, <strong>ETFs</strong> are the
                natural fit.</p>
        </section>

        <!-- ACCOUNT TYPES & TAXES -->
        <section id="accounts">
            <h2>Account Types & Tax Basics</h2>
            <br>
            <div class="grid three">
                <div class="card">
                    <h3>Taxable Brokerage</h3>
                    <ul>
                        <li>Flexible; no contribution limits.</li>
                        <li>Dividends/interest taxed annually; capital gains when you sell.</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Traditional IRA / 401(k)</h3>
                    <ul>
                        <li>Pre‑tax contributions (often deductible); taxes at withdrawal.</li>
                        <li>Good if you expect lower tax rate in retirement.</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Roth IRA / Roth 401(k)</h3>
                    <ul>
                        <li>After‑tax contributions; tax‑free qualified withdrawals.</li>
                        <li>Good if you expect similar or higher future tax rate.</li>
                    </ul>
                </div>
            </div>
            <p class="tip"><strong>T‑bill interest</strong> is generally <em>state‑tax‑exempt</em>; HYSA/CD interest is
                usually taxable at both federal and state levels.</p>
        </section>

        <!-- SHORT‑TERM CASH/YIELD EXPLAINER -->
        <section id="short-term-cash">
            <h2>Short‑Term Cash & Yield Options (for Money You’ll Use Soon)</h2>
            <br>
            <div class="grid two">
                <div class="card">
                    <h3>Treasury Bills / Ultra‑Short Treasury ETFs</h3>
                    <ul>
                        <li>3–6 month T‑Bills; or ETFs like <code>SGOV/BIL</code>.</li>
                        <li>Low price volatility; daily liquidity.</li>
                        <li>Interest typically exempt from state income tax.</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>HYSA, Money Market Funds, No‑Penalty CDs</h3>
                    <ul>
                        <li>Simple, liquid; yields vary with rates.</li>
                        <li>No‑penalty CDs let you break early without fee.</li>
                    </ul>
                </div>
            </div>
            <p class="warn"><strong>Avoid:</strong> long‑duration bonds or stocks for near‑term goals—prices can swing
                right before you need the cash.</p>
        </section>

        <!-- CHARTS -->
        <section id="investment-charts">
            <h2>Investment Charts</h2>
            <br>
            <div class="card">
                <h3>Savings Balance Projection (Example)</h3>
                <canvas id="houseChart" height="120" aria-label="Savings projection chart" role="img"></canvas>
            </div>
        </section>

        <!-- CALCULATORS -->
        <section id="calculators">
            <h2>Calculators</h2>
            <p class="muted" style="margin-top:-.5rem">Educational estimates only; not tax or investment advice.</p>
            <div class="grid two">
                <!-- Savings Growth Planner -->
                <div class="card">
                    <h3>Savings Growth Planner (12–24 months)</h3>
                    <form id="houseForm" class="calc-form" novalidate>
                        <label for="hf_initial">Initial Balance ($)</label>
                        <input type="number" id="hf_initial" value="10000" min="0" step="0.01" required />

                        <label for="hf_monthly">Monthly Contribution ($)</label>
                        <input type="number" id="hf_monthly" value="1500" min="0" step="0.01" required />

                        <label for="hf_months">Months</label>
                        <select id="hf_months">
                            <option value="12" selected>12</option>
                            <option value="15">15</option>
                            <option value="18">18</option>
                            <option value="24">24</option>
                        </select>

                        <label for="hf_apy">APY (%) <span class="tooltip"
                                data-tooltip="Annual Percentage Yield; includes compounding.">?</span></label>
                        <input type="number" id="hf_apy" value="4.2" step="0.1" required />

                        <div class="flex">
                            <input type="checkbox" id="hf_tbill" />
                            <label for="hf_tbill">Treasury interest (state‑tax‑exempt)</label>
                        </div>

                        <label for="hf_fed">Est. Federal Tax Rate on Interest (%) <span class="tooltip"
                                data-tooltip="Your marginal federal income tax rate applied to interest.">?</span></label>
                        <input type="number" id="hf_fed" value="22" step="1" />

                        <label for="hf_state">State Tax Rate on Interest (%) <span class="tooltip"
                                data-tooltip="Your marginal state income tax rate applied to interest (T‑bills usually exempt).">?</span></label>
                        <input type="number" id="hf_state" value="5" step="0.5" />

                        <div class="btn-row">
                            <button type="submit">Calculate</button>
                            <button type="button" id="hf_reset" title="Reset and clear saved inputs">Reset</button>
                        </div>
                    </form>
                    <div id="houseResult" class="calc-result" aria-live="polite"></div>
                </div>

                <!-- Roth vs Traditional -->
                <div class="card">
                    <h3>Roth vs. Traditional (Which gives you more?)</h3>
                    <form id="rothForm" class="calc-form" novalidate>
                        <label for="r_amount">Contribution Amount ($)</label>
                        <input type="number" id="r_amount" value="7000" min="0" step="0.01" required />

                        <label for="r_now">Current Marginal Tax Rate (%) <span class="tooltip"
                                data-tooltip="Tax rate on your last dollar of income today.">?</span></label>
                        <input type="number" id="r_now" value="22" step="1" required />

                        <label for="r_ret">Retirement Marginal Tax Rate (%) <span class="tooltip"
                                data-tooltip="Estimated marginal rate when you withdraw in retirement.">?</span></label>
                        <input type="number" id="r_ret" value="22" step="1" required />

                        <label for="r_years">Years to Invest</label>
                        <input type="number" id="r_years" value="20" min="1" step="1" required />

                        <label for="r_return">Expected Annual Return (%) <span class="tooltip"
                                data-tooltip="Long‑run average assumption; not a guarantee.">?</span></label>
                        <input type="number" id="r_return" value="7" step="0.1" required />

                        <div class="btn-row">
                            <button type="submit">Compare</button>
                            <button type="button" id="r_reset">Reset</button>
                        </div>
                    </form>
                    <div id="rothResult" class="calc-result" aria-live="polite"></div>
                </div>
            </div>

            <div class="grid two" style="margin-top:10px;">
                <!-- Capital Gains Estimator -->
                <div class="card">
                    <h3>Capital Gains Tax — Clean Estimator</h3>
                    <form id="gainsForm" class="calc-form" novalidate>
                        <label for="cg_buy">Purchase Price ($)</label>
                        <input type="number" id="cg_buy" placeholder="1000" min="0" step="0.01" required />

                        <label for="cg_sell">Sale Price ($)</label>
                        <input type="number" id="cg_sell" placeholder="1500" min="0" step="0.01" required />

                        <div class="flex">
                            <input type="checkbox" id="cg_long" />
                            <label for="cg_long">Held ≥ 1 year (long‑term) <span class="tooltip"
                                    data-tooltip="Long‑term gains typically taxed at preferential federal rates.">?</span></label>
                        </div>

                        <label for="cg_oir">Ordinary Income Tax Rate (for short‑term) % <span class="tooltip"
                                data-tooltip="Short‑term gains are taxed like ordinary income.">?</span></label>
                        <input type="number" id="cg_oir" value="24" step="1" />

                        <label for="cg_ltcg">Long‑Term Capital Gains Rate % <span class="tooltip"
                                data-tooltip="Your federal long‑term capital gains bracket.">?</span></label>
                        <input type="number" id="cg_ltcg" value="15" step="1" />

                        <label for="cg_state">State Tax Rate on Gains % <span class="tooltip"
                                data-tooltip="State taxes often apply to gains; rates vary.">?</span></label>
                        <input type="number" id="cg_state" value="5" step="0.5" />

                        <div class="btn-row">
                            <button type="submit">Estimate</button>
                            <button type="button" id="cg_reset">Reset</button>
                        </div>
                    </form>
                    <div id="gainsResult" class="calc-result" aria-live="polite"></div>
                </div>

                <!-- Side‑Hustle Profit (examples) -->
                <div class="card">
                    <h3>Small Venture Profit Estimator (examples: vending, ATM, laundry)</h3>
                    <form id="hustleForm" class="calc-form" novalidate>
                        <label for="hs_type">Model Type</label>
                        <select id="hs_type">
                            <option value="vending" selected>Vending</option>
                            <option value="atm">ATM</option>
                        </select>

                        <div id="hs_vending_inputs">
                            <label for="v_gross">Monthly Gross Sales ($)</label>
                            <input type="number" id="v_gross" value="1200" min="0" step="0.01" />
                            <label for="v_cogs">COGS % <span class="tooltip"
                                    data-tooltip="Cost of Goods Sold — product cost as a % of sales.">?</span></label>
                            <input type="number" id="v_cogs" value="50" step="0.1" />
                            <label for="v_comm">Location Commission % <span class="tooltip"
                                    data-tooltip="Revenue share paid to the site owner.">?</span></label>
                            <input type="number" id="v_comm" value="15" step="0.1" />
                            <label for="v_fixed">Fixed Fees ($/mo) <span class="tooltip"
                                    data-tooltip="E.g., route fuel, warehouse, service, card processing minimums.">?</span></label>
                            <input type="number" id="v_fixed" value="40" min="0" step="0.01" />
                            <label for="v_cost">Machine Cost ($ one‑time) <span class="tooltip"
                                    data-tooltip="Acquisition price before tax/shipping.">?</span></label>
                            <input type="number" id="v_cost" value="3300" min="0" step="0.01" />
                        </div>

                        <div id="hs_atm_inputs" style="display:none;">
                            <label for="a_txn">Withdrawals / month</label>
                            <input type="number" id="a_txn" value="200" min="0" step="1" />
                            <label for="a_net">Net per transaction ($) <span class="tooltip"
                                    data-tooltip="Your surcharge minus processing/owner share.">?</span></label>
                            <input type="number" id="a_net" value="1.9" step="0.01" />
                            <label for="a_fixed">Fixed Fees ($/mo) <span class="tooltip"
                                    data-tooltip="Communications, cash handling, armored pickup, etc.">?</span></label>
                            <input type="number" id="a_fixed" value="50" min="0" step="0.01" />
                            <label for="a_cost">Machine Cost ($ one‑time) <span class="tooltip"
                                    data-tooltip="ATM purchase price.">?</span></label>
                            <input type="number" id="a_cost" value="3800" min="0" step="0.01" />
                        </div>

                        <div class="btn-row">
                            <button type="submit">Run</button>
                            <button type="button" id="hs_reset">Reset</button>
                        </div>
                    </form>
                    <div id="hustleResult" class="calc-result" aria-live="polite"></div>
                </div>
            </div>
        </section>

        <!-- FAQ -->
        <section id="faq">
            <h2>FAQ</h2>
            <div class="card">
                <h3>Does my IRA count as home equity?</h3>
                <p>No. It can count as <em>reserves</em> for underwriting. It becomes equity only if you withdraw and
                    use it for the down payment (mind taxes/penalties and first‑time homebuyer rules).</p>
            </div>
            <div class="card">
                <h3>Does my brokerage account count as equity?</h3>
                <p>No. It’s an asset. It becomes equity after you sell and bring cash to closing. Brokerage balances can
                    also help with <em>reserves</em> requirements.</p>
            </div>
            <div class="card">
                <h3>When should I move near‑term funds to cash?</h3>
                <p>60–90 days before closing, stop auto‑invest and start letting distributions and maturities pile up in
                    cash. Consider selling gradually into cash to avoid timing risk.</p>
            </div>
        </section>

        <!-- DEFINITIONS -->
        <section id="definitions">
            <h2>Key Terms</h2>
            <ul>
                <li><strong>ETF:</strong> Fund trading on an exchange; often tracks an index.</li>
                <li><strong>Index Fund:</strong> Mutual fund tracking an index; priced once daily.</li>
                <li><strong>HYSA:</strong> High‑Yield Savings Account.</li>
                <li><strong>T‑Bill:</strong> U.S. Treasury bill, typically 4–52 weeks.</li>
                <li><strong>Expense Ratio:</strong> Annual fee of a fund/ETF.</li>
                <li><strong>Capital Gain:</strong> Profit when sale price exceeds purchase price; tax depends on holding
                    period.</li>
                <li><strong>Roth IRA</strong> & <strong>Traditional IRA</strong></li>
            </ul>
        </section>
    </main>

    <aside></aside>

    <footer class="muted" style="text-align:center; margin: 2rem 0 1rem;">
        <p>&copy; <span id="year"></span> Your Investment Education Site</p>
    </footer>

    <script>
        // year
        document.getElementById('year').textContent = new Date().getFullYear();

        // ======= Currency / number formatting helpers =======
        const fmt2 = (n) => Number(n).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });

        // ======= Chart: stacked contributions vs interest =======
        let houseChart;
        function drawHouseChart(rows) {
            const ctx = document.getElementById('houseChart');
            if (!ctx || typeof Chart === 'undefined') return;
            if (houseChart) houseChart.destroy();
            const labels = rows.map(r => 'M' + r.month);
            houseChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [
                        { label: 'Contributions', data: rows.map(r => r.contrib), fill: true },
                        { label: 'Interest', data: rows.map(r => r.interest), fill: true }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: { mode: 'index', intersect: false },
                    scales: { y: { beginAtZero: true, stacked: true } },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `${ctx.dataset.label}: $${fmt2(ctx.parsed.y)}`
                            }
                        }
                    }
                }
            });
        }

        // ======= Small util: form persistence =======
        function bindFormPersistence(formId, ids) {
            const key = (id) => `${formId}:${id}`;
            ids.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                const saved = localStorage.getItem(key(id));
                if (saved !== null) {
                    if (el.type === 'checkbox') el.checked = saved === '1'; else el.value = saved;
                }
                el.addEventListener('change', () => {
                    localStorage.setItem(key(id), el.type === 'checkbox' ? (el.checked ? '1' : '0') : el.value);
                });
            });
            // reset helper
            const resetBtn = document.getElementById(formId.replace('Form', '_reset'));
            if (resetBtn) {
                resetBtn.addEventListener('click', () => {
                    ids.forEach(id => localStorage.removeItem(key(id)));
                    document.getElementById(formId).reset();
                    // Trigger a recompute if the form has a submit handler
                    document.getElementById(formId)?.dispatchEvent(new Event('submit'));
                });
            }
        }

        // ======= Savings Growth Planner =======
        const hfForm = document.getElementById('houseForm');
        bindFormPersistence('houseForm', ['hf_initial', 'hf_monthly', 'hf_months', 'hf_apy', 'hf_tbill', 'hf_fed', 'hf_state']);
        hfForm?.addEventListener('submit', (e) => {
            e.preventDefault();
            const initial = Math.max(0, Number(document.getElementById('hf_initial').value || 0));
            const monthly = Math.max(0, Number(document.getElementById('hf_monthly').value || 0));
            const months = Math.max(1, Number(document.getElementById('hf_months').value || 12));
            const apy = Math.max(0, Number(document.getElementById('hf_apy').value || 0)) / 100;
            const isTbill = document.getElementById('hf_tbill').checked;
            const fed = Math.max(0, Number(document.getElementById('hf_fed').value || 0)) / 100;
            const state = Math.max(0, Number(document.getElementById('hf_state').value || 0)) / 100;

            const r = Math.pow(1 + apy, 1 / 12) - 1; // monthly rate
            let bal = initial;
            let interestAcc = 0;
            const rows = [];
            for (let m = 1; m <= months; m++) {
                bal += monthly;              // deposit at start of month
                const i = bal * r;           // interest on current balance
                interestAcc += i;
                bal += i;
                const contrib = initial + monthly * m;
                rows.push({ month: m, contrib, interest: interestAcc, total: contrib + interestAcc });
            }
            const contribTotal = initial + monthly * months;
            const pre = contribTotal + interestAcc;
            const interestAfter = isTbill ? (interestAcc * (1 - fed)) : (interestAcc * (1 - fed - state));
            const after = contribTotal + interestAfter;

            document.getElementById('houseResult').innerHTML = `
        Contributions: <strong>$${fmt2(contribTotal)}</strong><br>
        Interest (pre‑tax): <strong>$${fmt2(interestAcc)}</strong><br>
        Ending Balance (pre‑tax): <strong>$${fmt2(pre)}</strong><br>
        Ending Balance (after est. tax): <strong>$${fmt2(after)}</strong>
      `;
            drawHouseChart(rows);
        });

        // Auto-run once with defaults (after Chart.js loads)
        window.addEventListener('load', () => { hfForm?.dispatchEvent(new Event('submit')); });

        // ======= Roth vs Traditional =======
        const rothForm = document.getElementById('rothForm');
        bindFormPersistence('rothForm', ['r_amount', 'r_now', 'r_ret', 'r_years', 'r_return']);
        rothForm?.addEventListener('submit', (e) => {
            e.preventDefault();
            const amt = Math.max(0, Number(document.getElementById('r_amount').value || 0));
            const now = Math.max(0, Number(document.getElementById('r_now').value || 0)) / 100;
            const ret = Math.max(0, Number(document.getElementById('r_ret').value || 0)) / 100;
            const yrs = Math.max(1, Number(document.getElementById('r_years').value || 0));
            const rate = Math.max(0, Number(document.getElementById('r_return').value || 0)) / 100;

            // Roth: invest amt, grows tax-free
            const rothFV = amt * Math.pow(1 + rate, yrs);

            // Traditional: invest pre-tax amt; tax owed at withdrawal
            const taxSavings = amt * now; // you could invest this too
            const tradFV = amt * Math.pow(1 + rate, yrs);
            const tradAfterTax = tradFV * (1 - ret);
            const bonusFV = taxSavings * Math.pow(1 + rate, yrs);
            const winner = (rothFV > tradAfterTax + bonusFV) ? 'Roth likely better at these rates' : 'Traditional likely better at these rates';

            document.getElementById('rothResult').innerHTML = `
        Roth FV: <strong>$${fmt2(rothFV)}</strong><br>
        Traditional FV (after retirement tax): <strong>$${fmt2(tradAfterTax)}</strong><br>
        + Tax‑savings side pot FV: <strong>$${fmt2(bonusFV)}</strong><br>
        → <strong>${winner}</strong>
      `;
        });

        // ======= Capital Gains Estimator =======
        const gainsForm = document.getElementById('gainsForm');
        bindFormPersistence('gainsForm', ['cg_buy', 'cg_sell', 'cg_long', 'cg_oir', 'cg_ltcg', 'cg_state']);
        gainsForm?.addEventListener('submit', (e) => {
            e.preventDefault();
            const buy = Math.max(0, Number(document.getElementById('cg_buy').value || 0));
            const sell = Math.max(0, Number(document.getElementById('cg_sell').value || 0));
            const long = document.getElementById('cg_long').checked;
            const oir = Math.max(0, Number(document.getElementById('cg_oir').value || 0)) / 100;
            const ltcg = Math.max(0, Number(document.getElementById('cg_ltcg').value || 0)) / 100;
            const state = Math.max(0, Number(document.getElementById('cg_state').value || 0)) / 100;

            const gain = sell - buy;
            const rate = long ? (ltcg + state) : (oir + state);
            const tax = gain > 0 ? gain * rate : 0;
            const after = gain - tax;

            document.getElementById('gainsResult').innerHTML = `
        Gain: <strong>$${fmt2(gain)}</strong><br>
        ${long ? 'Long‑term' : 'Short‑term'} total est. tax rate: <strong>${(rate * 100).toFixed(1)}%</strong><br>
        Tax owed: <strong>$${fmt2(tax)}</strong><br>
        After‑tax gain: <strong>$${fmt2(after)}</strong>
      `;
        });

        // ======= Side‑Hustle Profit =======
        const typeSel = document.getElementById('hs_type');
        const vBox = document.getElementById('hs_vending_inputs');
        const aBox = document.getElementById('hs_atm_inputs');
        bindFormPersistence('hustleForm', ['hs_type', 'v_gross', 'v_cogs', 'v_comm', 'v_fixed', 'v_cost', 'a_txn', 'a_net', 'a_fixed', 'a_cost']);
        typeSel?.addEventListener('change', () => {
            const isV = typeSel.value === 'vending';
            vBox.style.display = isV ? '' : 'none';
            aBox.style.display = isV ? 'none' : '';
        });

        const hustleForm = document.getElementById('hustleForm');
        hustleForm?.addEventListener('submit', (e) => {
            e.preventDefault();
            if (typeSel.value === 'vending') {
                const gross = Math.max(0, Number(document.getElementById('v_gross').value || 0));
                const cogs = Math.max(0, Number(document.getElementById('v_cogs').value || 0)) / 100;
                const comm = Math.max(0, Number(document.getElementById('v_comm').value || 0)) / 100;
                const fixed = Math.max(0, Number(document.getElementById('v_fixed').value || 0));
                const cost = Math.max(0, Number(document.getElementById('v_cost').value || 0));
                const net = gross - (gross * cogs) - (gross * comm) - fixed;
                const paybackMonths = net > 0 ? cost / net : Infinity;
                document.getElementById('hustleResult').innerHTML = `
          Net / month: <strong>$${fmt2(net)}</strong><br>
          Payback (machine only): <strong>${isFinite(paybackMonths) ? paybackMonths.toFixed(1) + ' mo' : 'n/a'}</strong>
        `;
            } else {
                const tx = Math.max(0, Number(document.getElementById('a_txn').value || 0));
                const per = Math.max(0, Number(document.getElementById('a_net').value || 0));
                const fixed = Math.max(0, Number(document.getElementById('a_fixed').value || 0));
                const cost = Math.max(0, Number(document.getElementById('a_cost').value || 0));
                const net = tx * per - fixed;
                const paybackMonths = net > 0 ? cost / net : Infinity;
                document.getElementById('hustleResult').innerHTML = `
          Net / month: <strong>$${fmt2(net)}</strong><br>
          Payback (machine only): <strong>${isFinite(paybackMonths) ? paybackMonths.toFixed(1) + ' mo' : 'n/a'}</strong>
        `;
            }
        });

        // ======= In‑page nav active link on scroll =======
        (function () {
            const links = Array.from(document.querySelectorAll('nav.subnav a[href^="#"]'));
            if (!links.length) return;
            const setActive = (id) => {
                links.forEach(l => l.classList.toggle('active', l.getAttribute('href') === '#' + id));
            };
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(en => { if (en.isIntersecting) setActive(en.target.id); });
            }, { rootMargin: "-45% 0px -50% 0px", threshold: 0.01 });
            document.querySelectorAll('main section[id]').forEach(sec => observer.observe(sec));
        })();
    </script>
</body>

</html>