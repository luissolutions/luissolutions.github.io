<!DOCTYPE html>
<html lang="en">

<head>
    <title>Smart Electronics Solutions</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/styles.css" rel="stylesheet">
    <link rel="icon" href="img/favicon.ico">
    <link rel="manifest" href="site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
    <link rel="icon" type="img/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="img/png" sizes="16x16" href="img/favicon-16x16.png">
    <script src="js/index.js" defer></script>
    <style>
        form {
            display: flex;
            flex-direction: column;
        }

        #main-window li {
            margin: 5px;
            list-style-type: decimal;
        }

        #main-window {
            display: flex;
            width: 800px;
        }

        textarea {
            margin: 0 auto;
            width: 800px;
        }
    </style>
</head>

<body>
    <header>
        <nav>
            <div class="logo-box">
                <a href="index.html"><img src="img/logo.gif" class="logo"></a>
            </div>
            <div class="name">Smart Electronics Solutions LLC</div>
            <div class="hamburger-box">
                <div class="hamburger">
                    <div class="line"></div>
                    <div class="line"></div>
                    <div class="line"></div>
                </div>
            </div>
            <div class="nav-buttons">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li><a href="tel:+18134211337"><img src="img/call-icon.png" alt="Call"></a></li>
                </ul>
            </div>
        </nav>
    </header>
    <div class="ico_container">
        <div class="ico">
            <a href="http://facebook.com"><img class="ico_img" src="img/black-facebook.png" alt="Facebook"></a>
            <a href="http://instagram.com"><img class="ico_img" src="img/black-instagram.png" alt="Instagram"></a>
            <a href="http://linkedin.com"><img class="ico_img" src="img/black-linkedin.png" alt="LinkedIn"></a>
            <a href="http://twitter.com"><img class="ico_img" src="img/black-twitter.png" alt="Twitter"></a>
            <a href="http://youtube.com"><img class="ico_img" src="img/black-youtube.png" alt="YouTube"></a>
        </div>
    </div>
    <main>
        <div id="login-window">
            <div class="toggle-buttons">
                <button id="show-login-btn">Login</button>
                <button id="show-signup-btn">Sign Up</button>
            </div>

            <div id="login-form-container">
                <h2>Login</h2>
                <br>
                <form id="loginForm">
                    <label for="loginEmail">Email:</label>
                    <input type="email" id="loginEmail" required><br>
                    <label for="loginPassword">Password:</label>
                    <input type="password" id="loginPassword" required><br>
                    <input type="submit" value="Login" id="login-submit">
                </form>
            </div>
            <div id="signup-form-container" style="display: none;">
                <h2>Register</h2>
                <br>
                <form class="reg" id="regForm">
                    <label for="username">Username:</label>
                    <input type="text" id="username" name="username">

                    <label for="first-name">First Name:</label>
                    <input type="text" id="first-name" name="first-name">

                    <label for="last-name">Last Name:</label>
                    <input type="text" id="last-name" name="last-name">

                    <label for="address">Address:</label>
                    <input type="text" id="address" name="address">

                    <label for="email">Email:</label>
                    <input type="email" id="regEmail" name="email" required>

                    <label for="phone">Phone Number:</label>
                    <input type="tel" id="phone" name="phone">

                    <label for="password">Password:</label>
                    <input type="password" id="regPassword" name="password" required>

                    <label for="confirm-password">Confirm Password:</label>
                    <input type="password" id="regConfirmPassword" name="confirm-password" required>
                    <br>
                    <button type="submit" id="register-submit">Register</button>
                </form>
            </div>
        </div>
    </main>
    <footer>
        <h3><a href="https://luissolutions.github.io">About Us</a> &#183; <a href="contact.html">Contact Us</a> &#183;
            <a href="#">Insured</a>
        </h3>
        <img id="padlock" src="img/lock.png" alt="Padlock">
    </footer>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, signOut, createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js';
        import { getDatabase, ref, onValue, set, off } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAg4UO0ASr-M19XCtoI8AZiNK2l5ddFDd0",
            authDomain: "notes-fba33.firebaseapp.com",
            databaseURL: "https://notes-fba33-default-rtdb.firebaseio.com",
            projectId: "notes-fba33",
            storageBucket: "notes-fba33.appspot.com",
            messagingSenderId: "312617117650",
            appId: "1:312617117650:web:721cc5bf322af639410a0b"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);

        const mainForm = document.getElementById('loginForm');
        const emailInp = document.getElementById('loginEmail');
        const passInp = document.getElementById('loginPassword');

        const regForm = document.getElementById('regForm');
        const emailReg = document.getElementById('regEmail');
        const passReg = document.getElementById('regPassword');
        const confirmPassReg = document.getElementById('regConfirmPassword');

        mainForm.addEventListener('submit', function (evt) {
            evt.preventDefault();
            signInWithEmailAndPassword(auth, emailInp.value, passInp.value)
                .then((credentials) => {
                    window.location.href = 'notes.html';
                })
                .catch((error) => {
                    console.error('Login error:', error);
                    alert("Error during login: " + error.message);
                });

        });

        document.getElementById('show-login-btn').addEventListener('click', () => {
            document.getElementById('login-form-container').style.display = 'block';
            document.getElementById('signup-form-container').style.display = 'none';
        });

        document.getElementById('show-signup-btn').addEventListener('click', () => {
            document.getElementById('login-form-container').style.display = 'none';
            document.getElementById('signup-form-container').style.display = 'block';
        });

        document.getElementById("register-submit").addEventListener("click", function (event) {
            event.preventDefault();

            const username = document.getElementById("username").value;
            const firstName = document.getElementById("first-name").value;
            const lastName = document.getElementById("last-name").value;
            const address = document.getElementById("address").value;
            const email = document.getElementById("regEmail").value;
            const password = document.getElementById("regPassword").value;
            const confirmPassword = document.getElementById("regConfirmPassword").value;
            const phone = document.getElementById("phone").value;

            if (!username || !email || !password) {
                alert("Please fill out all required fields (Username, Email, Password).");
                return;
            }

            if (password !== confirmPassword) {
                alert("Passwords do not match. Please try again.");
                return;
            }

            var userInfo = {
                email: email,
                username: username,
                password: password,
                phone: phone,
                firstName: firstName,
                lastName: lastName,
                address: address
            };

            var userRef = ref(database, "users/" + email.replace(/\W/g, ""));
            set(userRef, userInfo);

            handleRegistration(event);

        });

        function handleRegistration(evt2) {
            evt2.preventDefault();

            if (passReg.value !== confirmPassReg.value) {
                alert('Passwords do not match. Please try again.');
                return;
            }

            if (auth.currentUser) {
                createUserWithEmailAndPassword(auth, emailReg.value, passReg.value)
                    .then((credentials) => {
                        console.log('User created:', credentials.user);
                        alert("Registration successful!");
                        document.getElementById("regForm").reset();
                    })
                    .catch((error) => {
                        console.error('Registration error:', error);
                        alert("Somethings wrong")
                    });
            } else {
                alert('You need to log in before you can register.');
            }
        }

    </script>
</body>

</html>